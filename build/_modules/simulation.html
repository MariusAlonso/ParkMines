
<!DOCTYPE html>

<html lang="fr">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>simulation &#8212; Documentation ParkMines 2021</title>
    <link rel="stylesheet" type="text/css" href="../_static/pygments.css" />
    <link rel="stylesheet" type="text/css" href="../_static/alabaster.css" />
    <link rel="stylesheet" type="text/css" href="../_static/graphviz.css" />
    <script data-url_root="../" id="documentation_options" src="../_static/documentation_options.js"></script>
    <script src="../_static/jquery.js"></script>
    <script src="../_static/underscore.js"></script>
    <script src="../_static/doctools.js"></script>
    <script src="../_static/translations.js"></script>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Recherche" href="../search.html" />
   
  <link rel="stylesheet" href="../_static/custom.css" type="text/css" />
  
  
  <meta name="viewport" content="width=device-width, initial-scale=0.9, maximum-scale=0.9" />

  </head><body>
  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          

          <div class="body" role="main">
            
  <h1>Code source de simulation</h1><div class="highlight"><pre>
<span></span><span class="kn">import</span> <span class="nn">random</span>

<span class="kn">from</span> <span class="nn">numpy.lib.utils</span> <span class="kn">import</span> <span class="n">deprecate</span>
<span class="kn">from</span> <span class="nn">vehicle</span> <span class="kn">import</span> <span class="n">Vehicle</span><span class="p">,</span> <span class="n">Stock</span><span class="p">,</span> <span class="n">RandomStock</span>
<span class="kn">import</span> <span class="nn">datetime</span>
<span class="kn">from</span> <span class="nn">robot</span> <span class="kn">import</span> <span class="n">Robot</span>
<span class="kn">import</span> <span class="nn">time</span>
<span class="kn">from</span> <span class="nn">display</span> <span class="kn">import</span> <span class="n">Display</span>
<span class="kn">from</span> <span class="nn">sortedcontainers</span> <span class="kn">import</span> <span class="n">SortedList</span>


<span class="k">class</span> <span class="nc">Simulation</span><span class="p">():</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">t0</span><span class="p">,</span> <span class="n">stock</span><span class="p">,</span> <span class="n">robots</span><span class="p">,</span> <span class="n">parking</span><span class="p">,</span> <span class="n">AlgorithmType</span><span class="p">,</span> <span class="n">order</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">print_in_terminal</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">display</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">max_t</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">optimization_parameters</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        t0 : date d&#39;initialisation</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">stock</span> <span class="o">=</span> <span class="n">stock</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">robots</span> <span class="o">=</span> <span class="n">robots</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">t</span> <span class="o">=</span> <span class="n">t0</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">max_t</span> <span class="o">=</span> <span class="n">max_t</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">parking</span> <span class="o">=</span> <span class="n">parking</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">print_in_terminal</span> <span class="o">=</span> <span class="n">print_in_terminal</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">optimization_parameters</span> <span class="o">=</span> <span class="n">optimization_parameters</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">last_printed_date</span> <span class="o">=</span> <span class="kc">None</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">before_deposit_delays</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">after_deposit_delays</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">retrieval_delays</span> <span class="o">=</span> <span class="p">[]</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">display</span> <span class="o">=</span> <span class="n">display</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">time_execution</span> <span class="o">=</span> <span class="mi">0</span>

        <span class="c1"># nb_events_tracker : dictionnaire contenant le nombre d&#39;évènements dans la file de priorité à chaque date</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">nb_events_tracker</span> <span class="o">=</span> <span class="p">{}</span>

        <span class="c1"># File d&#39;évènements</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">events</span> <span class="o">=</span> <span class="n">SortedList</span><span class="p">()</span>
        <span class="c1"># File des déposits pas encore effectués</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">deposit_events</span> <span class="o">=</span> <span class="n">SortedList</span><span class="p">()</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">events</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">Event</span><span class="p">(</span><span class="kc">None</span><span class="p">,</span> <span class="n">t0</span><span class="p">,</span> <span class="s2">&quot;start&quot;</span><span class="p">))</span>
        <span class="k">for</span> <span class="n">v</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">stock</span><span class="o">.</span><span class="n">vehicles</span><span class="o">.</span><span class="n">values</span><span class="p">():</span>
            <span class="k">if</span> <span class="n">order</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">events</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">Event</span><span class="p">(</span><span class="n">v</span><span class="p">,</span> <span class="n">v</span><span class="o">.</span><span class="n">order_deposit</span><span class="p">,</span> <span class="s2">&quot;order_deposit&quot;</span><span class="p">))</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">events</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">Event</span><span class="p">(</span><span class="n">v</span><span class="p">,</span> <span class="n">v</span><span class="o">.</span><span class="n">order_retrieval</span><span class="p">,</span> <span class="s2">&quot;order_retrieval&quot;</span><span class="p">))</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">deposit_event</span> <span class="o">=</span> <span class="n">Event</span><span class="p">(</span><span class="n">v</span><span class="p">,</span> <span class="n">v</span><span class="o">.</span><span class="n">deposit</span><span class="p">,</span> <span class="s2">&quot;deposit&quot;</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">events</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">deposit_event</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">events</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">Event</span><span class="p">(</span><span class="n">v</span><span class="p">,</span> <span class="n">v</span><span class="o">.</span><span class="n">retrieval</span><span class="p">,</span> <span class="s2">&quot;retrieval&quot;</span><span class="p">))</span>    
                <span class="bp">self</span><span class="o">.</span><span class="n">deposit_events</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">deposit_event</span><span class="p">)</span>

        <span class="c1"># File des déposits des clients qui patientent à l&#39;interface</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">pending_deposits</span> <span class="o">=</span> <span class="n">SortedList</span><span class="p">()</span>
        <span class="c1"># File des retrievals des clients qui patientent à l&#39;interface</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">pending_retrievals</span> <span class="o">=</span> <span class="n">SortedList</span><span class="p">()</span>
        <span class="c1"># File des véhicules dans le parking classés selon leur date de retrieval</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">retrievals_in_parking</span> <span class="o">=</span> <span class="n">SortedList</span><span class="p">()</span>
        <span class="c1"># Ensemble des véhicules qu&#39;il reste à traiter dans la simulation</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">vehicles_left_to_handle</span> <span class="o">=</span> <span class="nb">set</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">stock</span><span class="o">.</span><span class="n">vehicles</span><span class="o">.</span><span class="n">keys</span><span class="p">())</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">vehicles_to_retrieve</span> <span class="o">=</span> <span class="p">[]</span>
    
        <span class="c1"># Dictionnaire des extrémités de lanes</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">locked_lanes</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="k">for</span> <span class="n">block_id</span><span class="p">,</span> <span class="n">block</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">parking</span><span class="o">.</span><span class="n">blocks</span><span class="p">):</span>
            <span class="k">for</span> <span class="n">lane_id</span><span class="p">,</span> <span class="n">lane</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">block</span><span class="o">.</span><span class="n">lanes</span><span class="p">):</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">locked_lanes</span><span class="p">[(</span><span class="n">block_id</span><span class="p">,</span> <span class="n">lane_id</span><span class="p">,</span> <span class="s2">&quot;top&quot;</span><span class="p">)]</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="ow">not</span> <span class="n">lane</span><span class="o">.</span><span class="n">top_access</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">locked_lanes</span><span class="p">[(</span><span class="n">block_id</span><span class="p">,</span> <span class="n">lane_id</span><span class="p">,</span> <span class="s2">&quot;bottom&quot;</span><span class="p">)]</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="ow">not</span> <span class="n">lane</span><span class="o">.</span><span class="n">bottom_access</span><span class="p">)</span>
        
        <span class="n">args</span> <span class="o">=</span> <span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">t</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">stock</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">robots</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">parking</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">events</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">locked_lanes</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">pending_retrievals</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">algorithm</span> <span class="o">=</span> <span class="n">AlgorithmType</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="n">print_in_terminal</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">print_in_terminal</span><span class="p">)</span> <span class="c1"># /!\ provisoire , optimization_parameters=optimization_parameters</span>

        <span class="c1"># Dictionnaires pour l&#39;analyse de flux</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">nb_entree</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">nb_sortie</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">nb_sortie_interface</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">nb_vehicles_interface</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">max_interface</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">nb_interface</span> <span class="o">=</span> <span class="mi">0</span>

        <span class="c1"># Exécution de tous les évènements antérieurs à la date d&#39;initialisation</span>
        <span class="k">while</span> <span class="bp">self</span><span class="o">.</span><span class="n">events</span><span class="p">:</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">events</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">date</span> <span class="o">==</span> <span class="n">t0</span><span class="p">:</span>
                <span class="k">break</span>
            <span class="n">event</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">events</span><span class="o">.</span><span class="n">pop</span><span class="p">()</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">t</span> <span class="o">=</span> <span class="n">event</span><span class="o">.</span><span class="n">date</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="n">event</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">execute</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">event</span><span class="p">):</span>

        <span class="c1">### AFFICHAGE DANS LE TERMINAL</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">last_printed_date</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">or</span> <span class="bp">self</span><span class="o">.</span><span class="n">t</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">last_printed_date</span> <span class="o">&gt;</span> <span class="n">datetime</span><span class="o">.</span><span class="n">timedelta</span><span class="p">(</span><span class="n">days</span><span class="o">=</span><span class="mi">7</span><span class="p">):</span>
            <span class="nb">print</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">t</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">last_printed_date</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">t</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">print_in_terminal</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">~~~~~~~~~~~~~~~~~~~~~~~~~~~~~</span><span class="se">\n</span><span class="s2">EXECUTION at time </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">t</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;event :&quot;</span><span class="p">,</span> <span class="n">event</span><span class="p">)</span>
            <span class="nb">print</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">parking</span><span class="o">.</span><span class="n">blocks</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">targeted</span><span class="p">)</span>
            <span class="n">c</span> <span class="o">=</span> <span class="mi">0</span>
            <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">parking</span><span class="o">.</span><span class="n">blocks</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">targeted</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">x</span><span class="p">:</span>
                    <span class="n">c</span> <span class="o">+=</span> <span class="mi">1</span>
                    <span class="k">if</span> <span class="n">c</span> <span class="o">&gt;</span> <span class="mi">2</span><span class="p">:</span>
                        <span class="k">raise</span> <span class="n">Error</span>
            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;-------------&quot;</span><span class="p">)</span>
            <span class="k">for</span> <span class="n">robot</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">robots</span><span class="p">:</span>
                <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot; - </span><span class="si">{</span><span class="n">robot</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
                <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;doing :&quot;</span><span class="p">,</span> <span class="n">robot</span><span class="o">.</span><span class="n">doing</span><span class="p">)</span>
                <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;target:&quot;</span><span class="p">,</span> <span class="n">robot</span><span class="o">.</span><span class="n">target</span><span class="p">)</span>
                <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;vehicle carrying:&quot;</span><span class="p">,</span> <span class="n">robot</span><span class="o">.</span><span class="n">vehicle</span><span class="p">)</span>
                <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;goal_position:&quot;</span><span class="p">,</span> <span class="n">robot</span><span class="o">.</span><span class="n">goal_position</span><span class="p">)</span>
            <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">            print(&quot;-------------&quot;)</span>
<span class="sd">            print([(k,self.locked_lanes[k]) for k in self.locked_lanes if self.locked_lanes[k]])</span>
<span class="sd">            &quot;&quot;&quot;</span>
            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;-------------&quot;</span><span class="p">)</span>
            <span class="k">for</span> <span class="n">block_id</span><span class="p">,</span> <span class="n">lane_id</span><span class="p">,</span> <span class="n">side</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">locked_lanes</span><span class="p">:</span>
                <span class="n">lane</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">parking</span><span class="o">.</span><span class="n">blocks</span><span class="p">[</span><span class="n">block_id</span><span class="p">]</span><span class="o">.</span><span class="n">lanes</span><span class="p">[</span><span class="n">lane_id</span><span class="p">]</span>
                <span class="nb">print</span><span class="p">((</span><span class="n">block_id</span><span class="p">,</span> <span class="n">lane_id</span><span class="p">,</span> <span class="n">side</span><span class="p">),</span> <span class="n">lane</span><span class="o">.</span><span class="n">top_position</span><span class="p">,</span> <span class="n">lane</span><span class="o">.</span><span class="n">argmax_retrieval</span><span class="p">,</span> <span class="n">lane</span><span class="o">.</span><span class="n">bottom_position</span><span class="p">)</span>
                <span class="nb">print</span><span class="p">((</span><span class="n">block_id</span><span class="p">,</span> <span class="n">lane_id</span><span class="p">,</span> <span class="n">side</span><span class="p">),</span> <span class="n">lane</span><span class="o">.</span><span class="n">future_top_position</span><span class="p">,</span> <span class="n">lane</span><span class="o">.</span><span class="n">future_bottom_position</span><span class="p">)</span>
            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;-------------&quot;</span><span class="p">)</span>
            <span class="nb">print</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">pending_retrievals</span><span class="p">)</span>
            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;-------------&quot;</span><span class="p">)</span>
            <span class="nb">print</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">parking</span><span class="o">.</span><span class="n">occupation</span><span class="p">)</span>
            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;-------------&quot;</span><span class="p">)</span>

        <span class="c1">### EXECUTION DE L&#39;EVENEMENT</span>
            
        <span class="n">vehicle</span> <span class="o">=</span> <span class="n">event</span><span class="o">.</span><span class="n">vehicle</span>

        <span class="k">if</span> <span class="n">event</span><span class="o">.</span><span class="n">event_type</span> <span class="o">==</span> <span class="s2">&quot;start&quot;</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">algorithm</span><span class="o">.</span><span class="n">update_start</span><span class="p">()</span>

        <span class="k">elif</span> <span class="n">event</span><span class="o">.</span><span class="n">event_type</span> <span class="o">==</span> <span class="s2">&quot;order_deposit&quot;</span><span class="p">:</span>
            <span class="n">deposit_event</span> <span class="o">=</span> <span class="n">Event</span><span class="p">(</span><span class="n">vehicle</span><span class="p">,</span> <span class="n">vehicle</span><span class="o">.</span><span class="n">deposit</span><span class="p">,</span> <span class="s2">&quot;deposit&quot;</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">events</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">deposit_event</span><span class="p">)</span>
            <span class="n">time_wake_up</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">t</span><span class="p">,</span> <span class="n">vehicle</span><span class="o">.</span><span class="n">deposit</span> <span class="o">-</span> <span class="n">datetime</span><span class="o">.</span><span class="n">timedelta</span><span class="p">(</span><span class="n">hours</span><span class="o">=</span><span class="mf">0.25</span><span class="p">))</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">events</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">Event</span><span class="p">(</span><span class="n">vehicle</span><span class="p">,</span> <span class="n">time_wake_up</span><span class="p">,</span> <span class="s2">&quot;wake_up_robots_deposit&quot;</span><span class="p">))</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">deposit_events</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">deposit_event</span><span class="p">)</span>
          
        <span class="k">elif</span> <span class="n">event</span><span class="o">.</span><span class="n">event_type</span> <span class="o">==</span> <span class="s2">&quot;order_retrieval&quot;</span><span class="p">:</span>
            <span class="n">event_retrieval</span> <span class="o">=</span> <span class="n">Event</span><span class="p">(</span><span class="n">vehicle</span><span class="p">,</span> <span class="n">vehicle</span><span class="o">.</span><span class="n">retrieval</span><span class="p">,</span> <span class="s2">&quot;retrieval&quot;</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">events</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">event_retrieval</span><span class="p">)</span>
            <span class="n">time_wake_up</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">t</span><span class="p">,</span> <span class="n">vehicle</span><span class="o">.</span><span class="n">retrieval</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">algorithm</span><span class="o">.</span><span class="n">anticipation_time</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">events</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">Event</span><span class="p">(</span><span class="n">vehicle</span><span class="p">,</span> <span class="n">time_wake_up</span><span class="p">,</span> <span class="s2">&quot;wake_up_robots_retrieval&quot;</span><span class="p">,</span> <span class="n">event_retrieval</span><span class="o">=</span><span class="n">event_retrieval</span><span class="p">))</span>

        <span class="k">elif</span> <span class="n">event</span><span class="o">.</span><span class="n">event_type</span> <span class="o">==</span> <span class="s2">&quot;wake_up_robots_retrieval&quot;</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">algorithm</span><span class="o">.</span><span class="n">check_redirections</span><span class="p">(</span><span class="n">event</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">t</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">algorithm</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">t</span><span class="p">)</span>

        
        <span class="k">elif</span> <span class="n">event</span><span class="o">.</span><span class="n">event_type</span> <span class="o">==</span> <span class="s2">&quot;wake_up_robots&quot;</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">event</span> <span class="o">==</span> <span class="bp">self</span><span class="o">.</span><span class="n">algorithm</span><span class="o">.</span><span class="n">current_wake_up</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">algorithm</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">t</span><span class="p">)</span>

        <span class="k">elif</span> <span class="n">event</span><span class="o">.</span><span class="n">event_type</span> <span class="o">==</span> <span class="s2">&quot;deposit&quot;</span><span class="p">:</span>

            <span class="n">success</span> <span class="o">=</span> <span class="kc">False</span>

            <span class="bp">self</span><span class="o">.</span><span class="n">nb_interface</span> <span class="o">+=</span> <span class="mi">1</span> <span class="c1"># une voiture entre dans l&#39;interface</span>
            <span class="n">nb_jour</span> <span class="o">=</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">t</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">stock</span><span class="o">.</span><span class="n">first_day</span><span class="p">)</span><span class="o">.</span><span class="n">days</span>

            <span class="k">if</span> <span class="n">nb_jour</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">nb_entree</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">nb_entree</span><span class="p">[</span><span class="n">nb_jour</span><span class="p">]</span> <span class="o">+=</span> <span class="mi">1</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">nb_entree</span><span class="p">[</span><span class="n">nb_jour</span><span class="p">]</span> <span class="o">=</span> <span class="mi">1</span>
            
            <span class="k">if</span> <span class="n">nb_jour</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">nb_vehicles_interface</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">nb_interface</span> <span class="o">&gt;</span> <span class="bp">self</span><span class="o">.</span><span class="n">max_interface</span><span class="p">:</span> 
                    <span class="bp">self</span><span class="o">.</span><span class="n">nb_vehicles_interface</span><span class="p">[</span><span class="n">nb_jour</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">nb_interface</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">max_interface</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">nb_interface</span>
            <span class="k">else</span><span class="p">:</span> <span class="c1">#Si c&#39;est un nouveau jour, on ajoute le nb d&#39;interface au 1er instant</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">nb_vehicles_interface</span><span class="p">[</span><span class="n">nb_jour</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">nb_interface</span>

            <span class="n">lane_id</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">parking</span><span class="o">.</span><span class="n">blocks</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">empty_lane</span><span class="p">()</span>
            <span class="k">if</span> <span class="n">lane_id</span> <span class="o">==</span> <span class="s2">&quot;full&quot;</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">pending_deposits</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">event</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">success</span> <span class="o">=</span> <span class="kc">True</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">deposit_events</span><span class="o">.</span><span class="n">pop</span><span class="p">()</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">retrievals_in_parking</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">vehicle</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">parking</span><span class="o">.</span><span class="n">blocks</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">lanes</span><span class="p">[</span><span class="n">lane_id</span><span class="p">]</span><span class="o">.</span><span class="n">push_reserve</span><span class="p">(</span><span class="n">vehicle</span><span class="o">.</span><span class="n">id</span><span class="p">,</span> <span class="s2">&quot;top&quot;</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">parking</span><span class="o">.</span><span class="n">blocks</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">lanes</span><span class="p">[</span><span class="n">lane_id</span><span class="p">]</span><span class="o">.</span><span class="n">push</span><span class="p">(</span><span class="n">vehicle</span><span class="o">.</span><span class="n">id</span><span class="p">,</span> <span class="s2">&quot;top&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">stock</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">parking</span><span class="o">.</span><span class="n">occupation</span><span class="p">[</span><span class="n">vehicle</span><span class="o">.</span><span class="n">id</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">lane_id</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>

                <span class="n">vehicle</span><span class="o">.</span><span class="n">effective_deposit</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">t</span>

                <span class="c1"># ajout du retard (nul) à la liste des retards au dépôt</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">before_deposit_delays</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">datetime</span><span class="o">.</span><span class="n">timedelta</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">))</span>
                
                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">display</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">display</span><span class="o">.</span><span class="n">draw_vehicle</span><span class="p">(</span><span class="n">vehicle</span><span class="p">)</span>

            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">print_in_terminal</span><span class="p">:</span>
                <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Deposit of </span><span class="si">{</span><span class="n">vehicle</span><span class="o">.</span><span class="n">id</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
                <span class="nb">print</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">parking</span><span class="p">)</span>
                <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;&quot;</span><span class="p">)</span>
            
            <span class="bp">self</span><span class="o">.</span><span class="n">algorithm</span><span class="o">.</span><span class="n">update_deposit</span><span class="p">(</span><span class="n">vehicle</span><span class="p">,</span> <span class="n">success</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">t</span><span class="p">)</span>

        <span class="k">elif</span> <span class="n">event</span><span class="o">.</span><span class="n">event_type</span> <span class="o">==</span> <span class="s2">&quot;retrieval&quot;</span><span class="p">:</span>
            <span class="n">nb_jour</span> <span class="o">=</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">t</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">stock</span><span class="o">.</span><span class="n">first_day</span><span class="p">)</span><span class="o">.</span><span class="n">days</span>

            <span class="n">success</span> <span class="o">=</span> <span class="kc">False</span>

            <span class="k">if</span> <span class="n">vehicle</span><span class="o">.</span><span class="n">id</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">parking</span><span class="o">.</span><span class="n">occupation</span><span class="p">:</span>
    
                <span class="n">i_block</span><span class="p">,</span> <span class="n">i_lane</span><span class="p">,</span> <span class="n">_</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">parking</span><span class="o">.</span><span class="n">occupation</span><span class="p">[</span><span class="n">vehicle</span><span class="o">.</span><span class="n">id</span><span class="p">]</span>
                <span class="k">if</span> <span class="n">i_block</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
                    
                    <span class="n">success</span> <span class="o">=</span> <span class="kc">True</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">retrieval_delays</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">t</span> <span class="o">-</span> <span class="n">vehicle</span><span class="o">.</span><span class="n">retrieval</span><span class="p">)</span>

                    <span class="bp">self</span><span class="o">.</span><span class="n">vehicles_left_to_handle</span><span class="o">.</span><span class="n">remove</span><span class="p">(</span><span class="n">vehicle</span><span class="o">.</span><span class="n">id</span><span class="p">)</span>

                    <span class="k">if</span> <span class="n">vehicle</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">retrievals_in_parking</span><span class="p">:</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">retrievals_in_parking</span><span class="o">.</span><span class="n">remove</span><span class="p">(</span><span class="n">vehicle</span><span class="p">)</span>
                    <span class="k">else</span><span class="p">:</span>
                        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;ERROR&quot;</span><span class="p">)</span>

                    <span class="k">if</span> <span class="n">nb_jour</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">nb_sortie</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">nb_sortie</span><span class="p">[</span><span class="n">nb_jour</span><span class="p">]</span> <span class="o">+=</span> <span class="mi">1</span>
                    <span class="k">else</span><span class="p">:</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">nb_sortie</span><span class="p">[</span><span class="n">nb_jour</span><span class="p">]</span> <span class="o">=</span> <span class="mi">1</span>

                    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">display</span><span class="p">:</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">display</span><span class="o">.</span><span class="n">erase_vehicle</span><span class="p">(</span><span class="n">vehicle</span><span class="p">)</span>

                    <span class="c1"># Le client récupère son véhicule (seul endroit dans simulation où cela se produit)</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">parking</span><span class="o">.</span><span class="n">blocks</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">lanes</span><span class="p">[</span><span class="n">i_lane</span><span class="p">]</span><span class="o">.</span><span class="n">pop_reserve</span><span class="p">(</span><span class="s2">&quot;top&quot;</span><span class="p">)</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">parking</span><span class="o">.</span><span class="n">blocks</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">lanes</span><span class="p">[</span><span class="n">i_lane</span><span class="p">]</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s2">&quot;top&quot;</span><span class="p">)</span>

                    
                    <span class="bp">self</span><span class="o">.</span><span class="n">nb_interface</span> <span class="o">-=</span> <span class="mi">1</span> <span class="c1"># un véhicule sort de l&#39;interface pour être rendu</span>

                    <span class="k">del</span> <span class="bp">self</span><span class="o">.</span><span class="n">parking</span><span class="o">.</span><span class="n">occupation</span><span class="p">[</span><span class="n">event</span><span class="o">.</span><span class="n">vehicle</span><span class="o">.</span><span class="n">id</span><span class="p">]</span>

                    <span class="c1"># On vérifie si un client peut déposer son véhicule dans la place libérée de l&#39;interface</span>
                    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">pending_deposits</span><span class="p">:</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">deposit_events</span><span class="o">.</span><span class="n">pop</span><span class="p">()</span>
                        <span class="n">event_deposit</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">pending_deposits</span><span class="o">.</span><span class="n">pop</span><span class="p">()</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">parking</span><span class="o">.</span><span class="n">blocks</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">lanes</span><span class="p">[</span><span class="n">i_lane</span><span class="p">]</span><span class="o">.</span><span class="n">push_reserve</span><span class="p">(</span><span class="n">event_deposit</span><span class="o">.</span><span class="n">vehicle</span><span class="o">.</span><span class="n">id</span><span class="p">,</span> <span class="s2">&quot;top&quot;</span><span class="p">)</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">parking</span><span class="o">.</span><span class="n">blocks</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">lanes</span><span class="p">[</span><span class="n">i_lane</span><span class="p">]</span><span class="o">.</span><span class="n">push</span><span class="p">(</span><span class="n">event_deposit</span><span class="o">.</span><span class="n">vehicle</span><span class="o">.</span><span class="n">id</span><span class="p">,</span> <span class="s2">&quot;top&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">stock</span><span class="p">)</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">parking</span><span class="o">.</span><span class="n">occupation</span><span class="p">[</span><span class="n">event_deposit</span><span class="o">.</span><span class="n">vehicle</span><span class="o">.</span><span class="n">id</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">i_lane</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">retrievals_in_parking</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">event_deposit</span><span class="o">.</span><span class="n">vehicle</span><span class="p">)</span>

                        <span class="c1"># ajout du retard éventuel à la liste des retards au dépôt</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">before_deposit_delays</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">t</span> <span class="o">-</span> <span class="n">event_deposit</span><span class="o">.</span><span class="n">date</span><span class="p">)</span>
                        <span class="c1"># mise à jour de la date de dépôt effectif du véhicule</span>
                        <span class="n">event_deposit</span><span class="o">.</span><span class="n">vehicle</span><span class="o">.</span><span class="n">effective_deposit</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">t</span>

                        <span class="bp">self</span><span class="o">.</span><span class="n">algorithm</span><span class="o">.</span><span class="n">update_deposit</span><span class="p">(</span><span class="n">event_deposit</span><span class="o">.</span><span class="n">vehicle</span><span class="p">,</span> <span class="kc">True</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">t</span><span class="p">)</span>

                        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">display</span><span class="p">:</span>
                            <span class="bp">self</span><span class="o">.</span><span class="n">display</span><span class="o">.</span><span class="n">draw_vehicle</span><span class="p">(</span><span class="n">event_deposit</span><span class="o">.</span><span class="n">vehicle</span><span class="p">)</span>

                        <span class="k">for</span> <span class="n">pdg_retrieval</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">pending_retrievals</span><span class="p">:</span>
                            <span class="c1"># Dans le cas où l&#39;on a mis dans l&#39;interface un véhicule qui était attendu par son client</span>
                            <span class="k">if</span> <span class="n">pdg_retrieval</span><span class="o">.</span><span class="n">vehicle</span><span class="o">.</span><span class="n">id</span> <span class="o">==</span> <span class="n">event_deposit</span><span class="o">.</span><span class="n">vehicle</span><span class="o">.</span><span class="n">id</span><span class="p">:</span>
                                <span class="bp">self</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="n">pdg_retrieval</span><span class="p">)</span>
                                <span class="bp">self</span><span class="o">.</span><span class="n">pending_retrievals</span><span class="o">.</span><span class="n">remove</span><span class="p">(</span><span class="n">pdg_retrieval</span><span class="p">)</span>
                                <span class="k">break</span>
                        
                    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">print_in_terminal</span><span class="p">:</span>
                        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Retrieval of </span><span class="si">{</span><span class="n">vehicle</span><span class="o">.</span><span class="n">id</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
                        <span class="nb">print</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">parking</span><span class="p">)</span>
                        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;&quot;</span><span class="p">)</span>

                <span class="k">else</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">pending_retrievals</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">event</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">for</span> <span class="n">pdg_deposit</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">pending_deposits</span><span class="p">:</span>
                    <span class="c1"># Si un client veut récuperer son véhicule alors qu&#39;il attent pour le déposer</span>
                    <span class="k">if</span> <span class="n">vehicle</span><span class="o">.</span><span class="n">id</span> <span class="o">==</span> <span class="n">pdg_deposit</span><span class="o">.</span><span class="n">vehicle</span><span class="o">.</span><span class="n">id</span><span class="p">:</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">vehicles_left_to_handle</span><span class="o">.</span><span class="n">remove</span><span class="p">(</span><span class="n">vehicle</span><span class="o">.</span><span class="n">id</span><span class="p">)</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">pending_deposits</span><span class="o">.</span><span class="n">remove</span><span class="p">(</span><span class="n">pdg_deposit</span><span class="p">)</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">deposit_events</span><span class="o">.</span><span class="n">remove</span><span class="p">(</span><span class="n">pdg_deposit</span><span class="p">)</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">algorithm</span><span class="o">.</span><span class="n">update_deposit</span><span class="p">(</span><span class="n">pdg_deposit</span><span class="o">.</span><span class="n">vehicle</span><span class="p">,</span> <span class="kc">True</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">t</span><span class="p">)</span>
                        <span class="c1"># ajout du retard éventuel à la liste des retards au dépôt</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">before_deposit_delays</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">t</span> <span class="o">-</span> <span class="n">pdg_deposit</span><span class="o">.</span><span class="n">date</span><span class="p">)</span>
                        <span class="c1"># mise à jour de la date de dépôt effectif du véhicule</span>
                        <span class="n">pdg_deposit</span><span class="o">.</span><span class="n">vehicle</span><span class="o">.</span><span class="n">effective_deposit</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">t</span>

                        <span class="k">break</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">pending_retrievals</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">event</span><span class="p">)</span>
            
            <span class="bp">self</span><span class="o">.</span><span class="n">algorithm</span><span class="o">.</span><span class="n">update_retrieval</span><span class="p">(</span><span class="n">vehicle</span><span class="p">,</span> <span class="n">success</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">t</span><span class="p">)</span>


        <span class="k">elif</span> <span class="n">event</span><span class="o">.</span><span class="n">event_type</span> <span class="o">==</span> <span class="s2">&quot;robot_arrival&quot;</span><span class="p">:</span>

            <span class="n">nb_jour</span> <span class="o">=</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">t</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">stock</span><span class="o">.</span><span class="n">first_day</span><span class="p">)</span><span class="o">.</span><span class="n">days</span>

            <span class="c1"># On vérifie qu&#39;il s&#39;agit bien de l&#39;évènement que le robot était en train de considérer</span>
            <span class="c1"># Cela pourrait ne pas être le cas si le robot a changé de tâche en cours de route</span>
            <span class="k">if</span> <span class="n">event</span> <span class="o">==</span> <span class="n">event</span><span class="o">.</span><span class="n">robot</span><span class="o">.</span><span class="n">doing</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">execute_robot_arrival</span><span class="p">(</span><span class="n">event</span><span class="p">,</span> <span class="n">vehicle</span><span class="p">)</span>
                                                

        <span class="k">elif</span> <span class="n">event</span><span class="o">.</span><span class="n">event_type</span> <span class="o">==</span> <span class="s2">&quot;robot_end_task&quot;</span><span class="p">:</span>

            <span class="c1"># On vérifie qu&#39;il s&#39;agit bien de l&#39;évènement que le robot était en train de considérer</span>
            <span class="c1"># Cela pourrait ne pas être le cas si le robot a changé de tâche en cours de route</span>
            <span class="k">if</span> <span class="n">event</span> <span class="o">==</span> <span class="n">event</span><span class="o">.</span><span class="n">robot</span><span class="o">.</span><span class="n">doing</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">execute_robot_end_task</span><span class="p">(</span><span class="n">event</span><span class="p">,</span> <span class="n">vehicle</span><span class="p">)</span>

    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">                self.wake_up_robots()</span>
<span class="sd">        </span>
<span class="sd">        event.robot.start_position = event.robot.goal_position</span>
<span class="sd">        event.robot.start_time = self.t</span>

<span class="sd">        if moved_vehicle.order_retrieval &lt;= self.t and moved_vehicle.retrieval - self.t &lt; self.algorithm.anticipation_time:</span>
<span class="sd">            i_lane = self.parking.blocks[0].empty_lane()</span>
<span class="sd">            side_chosen_initially = self.side_chosen_to_retrieve[moved_vehicle.id]</span>
<span class="sd">            self.locked_lanes[event.robot.goal_position[:2] + (side_chosen_initially,)] -= 1</span>
<span class="sd">            self.parking.blocks[0].lanes[i_lane].push_reserve(moved_vehicle.id, &quot;bottom&quot;, mark=False)</span>
<span class="sd">            self.parking.blocks[0].lanes[i_lane].list_vehicles[0] = &quot;Lock&quot;</span>
<span class="sd">            #On place le vehicule a l&#39;interface</span>
<span class="sd">            event.robot.goal_position = (0, i_lane, &quot;bottom&quot;)</span>
<span class="sd">            self.parking.blocks[0].nb_places_available -= 1</span>
<span class="sd">            </span>
<span class="sd">            self.nb_interface += 1 #Un véhicle arrive dans l&#39;interface avant de sortir</span>
<span class="sd">            if nb_jour in self.nb_vehicles_interface.keys():</span>
<span class="sd">                if self.nb_interface &gt; self.max_interface: </span>
<span class="sd">                    self.nb_vehicles_interface[nb_jour] = self.nb_interface</span>
<span class="sd">                    self.max_interface = self.nb_interface</span>
<span class="sd">            else: #Si c&#39;est un nouveau jour, on ajoute le nb d&#39;interface au 1er instant</span>
<span class="sd">                self.nb_vehicles_interface[nb_jour] = self.nb_interface</span>
<span class="sd">            </span>
<span class="sd">            event.robot.goal_time = self.t + self.parking.travel_time(event.robot.start_position, event.robot.goal_position)</span>
<span class="sd">            event_end_task = Event(moved_vehicle, event.robot.goal_time, &quot;robot_end_task&quot;, event.robot)</span>
<span class="sd">            self.events.add(Event(moved_vehicle, event.robot.goal_time, &quot;robot_end_task&quot;, event.robot))</span>
<span class="sd">            event.robot.doing = event_end_task</span>

<span class="sd">        else:</span>
<span class="sd">            # Effet de bord de l&#39;appel : bloque le side de la lane si avec l&#39;ajout du moved_vehicle il est rempli</span>
<span class="sd">            event.robot.goal_position = self.algorithm.place(moved_vehicle, event.robot.goal_position, self.t)</span>
<span class="sd">            </span>
<span class="sd">            event.robot.goal_time = self.t + self.parking.travel_time(event.robot.start_position, event.robot.goal_position)</span>
<span class="sd">            event_end_task = Event(moved_vehicle, event.robot.goal_time, &quot;robot_end_task&quot;, event.robot)</span>
<span class="sd">            self.events.add(Event(moved_vehicle, event.robot.goal_time, &quot;robot_end_task&quot;, event.robot))</span>
<span class="sd">            event.robot.doing = event_end_task</span>
<span class="sd">    </span>
<span class="sd">    &quot;&quot;&quot;</span>



    <span class="k">def</span> <span class="nf">execute_robot_end_task</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">event</span><span class="p">,</span> <span class="n">vehicle</span><span class="p">):</span>

        <span class="n">block_id</span><span class="p">,</span> <span class="n">lane_id</span><span class="p">,</span> <span class="n">side</span> <span class="o">=</span> <span class="n">event</span><span class="o">.</span><span class="n">robot</span><span class="o">.</span><span class="n">goal_position</span>
        <span class="n">lane</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">parking</span><span class="o">.</span><span class="n">blocks</span><span class="p">[</span><span class="n">block_id</span><span class="p">]</span><span class="o">.</span><span class="n">lanes</span><span class="p">[</span><span class="n">lane_id</span><span class="p">]</span>

        <span class="n">event</span><span class="o">.</span><span class="n">robot</span><span class="o">.</span><span class="n">start_position</span> <span class="o">=</span> <span class="n">event</span><span class="o">.</span><span class="n">robot</span><span class="o">.</span><span class="n">goal_position</span>
        <span class="n">event</span><span class="o">.</span><span class="n">robot</span><span class="o">.</span><span class="n">start_time</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">t</span>
        <span class="n">event</span><span class="o">.</span><span class="n">robot</span><span class="o">.</span><span class="n">goal_time</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="n">event</span><span class="o">.</span><span class="n">robot</span><span class="o">.</span><span class="n">doing</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="n">event</span><span class="o">.</span><span class="n">robot</span><span class="o">.</span><span class="n">target</span> <span class="o">=</span> <span class="kc">None</span>

        <span class="n">success</span> <span class="o">=</span> <span class="kc">False</span> <span class="c1"># Pourl&#39;instant ...</span>

        <span class="c1"># On vérifie qu&#39;il y ait bien la place de mettre le véhicule</span>
        <span class="k">if</span> <span class="n">lane</span><span class="o">.</span><span class="n">end_position</span><span class="p">(</span><span class="n">side</span><span class="p">)</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">or</span> <span class="nb">abs</span><span class="p">(</span><span class="n">lane</span><span class="o">.</span><span class="n">end_position</span><span class="p">(</span><span class="n">side</span><span class="p">)</span> <span class="o">-</span> <span class="n">lane</span><span class="o">.</span><span class="n">end_limit</span><span class="p">(</span><span class="n">side</span><span class="p">))</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>

            <span class="n">success</span> <span class="o">=</span> <span class="kc">True</span>
            
            <span class="c1">### Exécution du dépôt du véhicule</span>
            
            <span class="n">lane</span><span class="o">.</span><span class="n">push</span><span class="p">(</span><span class="n">vehicle</span><span class="o">.</span><span class="n">id</span><span class="p">,</span> <span class="n">side</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">stock</span><span class="p">)</span>
            <span class="n">event</span><span class="o">.</span><span class="n">robot</span><span class="o">.</span><span class="n">vehicle</span> <span class="o">=</span> <span class="kc">None</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">parking</span><span class="o">.</span><span class="n">occupation</span><span class="p">[</span><span class="n">vehicle</span><span class="o">.</span><span class="n">id</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="n">block_id</span><span class="p">,</span> <span class="n">lane_id</span><span class="p">,</span> <span class="n">lane</span><span class="o">.</span><span class="n">end_position</span><span class="p">(</span><span class="n">side</span><span class="p">))</span>

            <span class="k">if</span> <span class="n">block_id</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
                <span class="k">for</span> <span class="n">pdg_retrieval</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">pending_retrievals</span><span class="p">:</span>
                    <span class="c1"># Dans le cas où l&#39;on a mis dans l&#39;interface un véhicule qui était attendu par son client</span>
                    <span class="k">if</span> <span class="n">pdg_retrieval</span><span class="o">.</span><span class="n">vehicle</span><span class="o">.</span><span class="n">id</span> <span class="o">==</span> <span class="n">vehicle</span><span class="o">.</span><span class="n">id</span><span class="p">:</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="n">pdg_retrieval</span><span class="p">)</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">pending_retrievals</span><span class="o">.</span><span class="n">remove</span><span class="p">(</span><span class="n">pdg_retrieval</span><span class="p">)</span>
                        <span class="k">break</span>
            
            <span class="c1">### Affichage du dépôt du véhicule </span>
            
            <span class="k">if</span> <span class="n">vehicle</span><span class="o">.</span><span class="n">id</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">parking</span><span class="o">.</span><span class="n">occupation</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">display</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">display</span><span class="o">.</span><span class="n">draw_vehicle</span><span class="p">(</span><span class="n">vehicle</span><span class="p">)</span>

            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">print_in_terminal</span><span class="p">:</span>
                <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">event</span><span class="o">.</span><span class="n">robot</span><span class="si">}</span><span class="s2"> places </span><span class="si">{</span><span class="n">vehicle</span><span class="o">.</span><span class="n">id</span><span class="si">}</span><span class="s2"> &quot;</span><span class="p">)</span>
                <span class="nb">print</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">parking</span><span class="p">)</span>
                <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;&quot;</span><span class="p">)</span>

        <span class="c1">### Mise à jour des tâches des robots et de la file de priorité</span>
        
        <span class="bp">self</span><span class="o">.</span><span class="n">algorithm</span><span class="o">.</span><span class="n">update_robot_end_task</span><span class="p">(</span><span class="n">event</span><span class="o">.</span><span class="n">robot</span><span class="p">,</span> <span class="n">event</span><span class="o">.</span><span class="n">robot</span><span class="o">.</span><span class="n">start_position</span><span class="p">,</span> <span class="n">success</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">t</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">execute_robot_arrival</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">event</span><span class="p">,</span> <span class="n">vehicle</span><span class="p">):</span>
        
        <span class="n">block_id</span><span class="p">,</span> <span class="n">lane_id</span><span class="p">,</span> <span class="n">side</span> <span class="o">=</span> <span class="n">event</span><span class="o">.</span><span class="n">robot</span><span class="o">.</span><span class="n">goal_position</span>
        <span class="n">pos_moved_vehicle</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">parking</span><span class="o">.</span><span class="n">blocks</span><span class="p">[</span><span class="n">block_id</span><span class="p">]</span><span class="o">.</span><span class="n">lanes</span><span class="p">[</span><span class="n">lane_id</span><span class="p">]</span><span class="o">.</span><span class="n">end_position</span><span class="p">(</span><span class="n">side</span><span class="p">)</span>

        <span class="n">event</span><span class="o">.</span><span class="n">robot</span><span class="o">.</span><span class="n">start_position</span> <span class="o">=</span> <span class="n">event</span><span class="o">.</span><span class="n">robot</span><span class="o">.</span><span class="n">goal_position</span>
        <span class="n">event</span><span class="o">.</span><span class="n">robot</span><span class="o">.</span><span class="n">start_time</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">t</span>
        <span class="n">event</span><span class="o">.</span><span class="n">robot</span><span class="o">.</span><span class="n">goal_time</span> <span class="o">=</span> <span class="kc">None</span> <span class="c1"># Pour l&#39;instant ...</span>
        

        <span class="n">moved_vehicle</span> <span class="o">=</span> <span class="kc">None</span> <span class="c1"># Pour l&#39;instant ...</span>
        <span class="n">success</span> <span class="o">=</span> <span class="kc">False</span>

        <span class="c1"># On vérifie qu&#39;il y ait bien un véhicule à récupérer</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="p">(</span><span class="n">pos_moved_vehicle</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">):</span>

            <span class="n">moved_vehicle</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">stock</span><span class="o">.</span><span class="n">vehicles</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">parking</span><span class="o">.</span><span class="n">blocks</span><span class="p">[</span><span class="n">block_id</span><span class="p">]</span><span class="o">.</span><span class="n">lanes</span><span class="p">[</span><span class="n">lane_id</span><span class="p">]</span><span class="o">.</span><span class="n">list_vehicles</span><span class="p">[</span><span class="n">pos_moved_vehicle</span><span class="p">]]</span>

            <span class="c1"># On vérifie que l&#39;algorithme souhaite toujours que le robot récupère le véhicule</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">algorithm</span><span class="o">.</span><span class="n">check_pick</span><span class="p">(</span><span class="n">event</span><span class="o">.</span><span class="n">robot</span><span class="o">.</span><span class="n">start_position</span><span class="p">,</span> <span class="n">moved_vehicle</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">t</span><span class="p">):</span>
                
                <span class="c1">### Exécution du retrait du véhicule</span>
                                
                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">display</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">display</span><span class="o">.</span><span class="n">erase_vehicle</span><span class="p">(</span><span class="n">moved_vehicle</span><span class="p">)</span>
            
                <span class="bp">self</span><span class="o">.</span><span class="n">parking</span><span class="o">.</span><span class="n">blocks</span><span class="p">[</span><span class="n">block_id</span><span class="p">]</span><span class="o">.</span><span class="n">lanes</span><span class="p">[</span><span class="n">lane_id</span><span class="p">]</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="n">side</span><span class="p">)</span>
                <span class="k">del</span> <span class="bp">self</span><span class="o">.</span><span class="n">parking</span><span class="o">.</span><span class="n">occupation</span><span class="p">[</span><span class="n">moved_vehicle</span><span class="o">.</span><span class="n">id</span><span class="p">]</span>
                <span class="n">event</span><span class="o">.</span><span class="n">robot</span><span class="o">.</span><span class="n">vehicle</span> <span class="o">=</span> <span class="n">moved_vehicle</span>   
                <span class="n">success</span> <span class="o">=</span> <span class="kc">True</span>

                <span class="c1"># On vérifie si une place est libérée dans l&#39;interface pour un éventuel client qui attendait pour un deposit</span>
                <span class="k">if</span> <span class="n">block_id</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">parking</span><span class="o">.</span><span class="n">blocks</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">nb_places_available</span> <span class="o">+=</span> <span class="mi">1</span>
                    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">pending_deposits</span><span class="p">:</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">deposit_events</span><span class="o">.</span><span class="n">pop</span><span class="p">()</span>
                        <span class="n">event_deposit</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">pending_deposits</span><span class="o">.</span><span class="n">pop</span><span class="p">()</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">parking</span><span class="o">.</span><span class="n">blocks</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">lanes</span><span class="p">[</span><span class="n">lane_id</span><span class="p">]</span><span class="o">.</span><span class="n">push_reserve</span><span class="p">(</span><span class="n">event_deposit</span><span class="o">.</span><span class="n">vehicle</span><span class="o">.</span><span class="n">id</span><span class="p">,</span> <span class="s2">&quot;top&quot;</span><span class="p">)</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">parking</span><span class="o">.</span><span class="n">blocks</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">lanes</span><span class="p">[</span><span class="n">lane_id</span><span class="p">]</span><span class="o">.</span><span class="n">push</span><span class="p">(</span><span class="n">event_deposit</span><span class="o">.</span><span class="n">vehicle</span><span class="o">.</span><span class="n">id</span><span class="p">,</span> <span class="s2">&quot;top&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">stock</span><span class="p">)</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">parking</span><span class="o">.</span><span class="n">occupation</span><span class="p">[</span><span class="n">event_deposit</span><span class="o">.</span><span class="n">vehicle</span><span class="o">.</span><span class="n">id</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">lane_id</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">retrievals_in_parking</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">event_deposit</span><span class="o">.</span><span class="n">vehicle</span><span class="p">)</span>

                        <span class="c1"># ajout du retard éventuel à la liste des retards au dépôt</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">before_deposit_delays</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">t</span> <span class="o">-</span> <span class="n">event_deposit</span><span class="o">.</span><span class="n">date</span><span class="p">)</span>
                        <span class="c1"># mise à jour de la date de dépôt effectif du véhicule</span>
                        <span class="n">event_deposit</span><span class="o">.</span><span class="n">vehicle</span><span class="o">.</span><span class="n">effective_deposit</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">t</span>

                        <span class="bp">self</span><span class="o">.</span><span class="n">algorithm</span><span class="o">.</span><span class="n">update_deposit</span><span class="p">(</span><span class="n">event_deposit</span><span class="o">.</span><span class="n">vehicle</span><span class="p">,</span> <span class="kc">True</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">t</span><span class="p">)</span>

                        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">display</span><span class="p">:</span>
                            <span class="bp">self</span><span class="o">.</span><span class="n">display</span><span class="o">.</span><span class="n">draw_vehicle</span><span class="p">(</span><span class="n">event_deposit</span><span class="o">.</span><span class="n">vehicle</span><span class="p">)</span>

                        <span class="k">for</span> <span class="n">pdg_retrieval</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">pending_retrievals</span><span class="p">:</span>
                            <span class="c1"># Dans le cas où l&#39;on a mis dans l&#39;interface un véhicule qui était attendu par son client</span>
                            <span class="k">if</span> <span class="n">pdg_retrieval</span><span class="o">.</span><span class="n">vehicle</span><span class="o">.</span><span class="n">id</span> <span class="o">==</span> <span class="n">event_deposit</span><span class="o">.</span><span class="n">vehicle</span><span class="o">.</span><span class="n">id</span><span class="p">:</span>
                                <span class="bp">self</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="n">pdg_retrieval</span><span class="p">)</span>
                                <span class="bp">self</span><span class="o">.</span><span class="n">pending_retrievals</span><span class="o">.</span><span class="n">remove</span><span class="p">(</span><span class="n">pdg_retrieval</span><span class="p">)</span>
                                <span class="k">break</span>

                <span class="k">if</span> <span class="n">block_id</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
                    <span class="c1"># ajout du retard éventuel à la liste des retards au dépôt</span>
                    <span class="k">try</span><span class="p">:</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">after_deposit_delays</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">t</span> <span class="o">-</span> <span class="n">moved_vehicle</span><span class="o">.</span><span class="n">effective_deposit</span><span class="p">)</span>
                    <span class="k">except</span><span class="p">:</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">after_deposit_delays</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">t</span> <span class="o">-</span> <span class="n">moved_vehicle</span><span class="o">.</span><span class="n">deposit</span><span class="p">)</span>
                    <span class="c1"># la place n&#39;est plus le siège d&#39;un évènement empty_interface</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">parking</span><span class="o">.</span><span class="n">blocks</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">targeted</span><span class="p">[</span><span class="n">lane_id</span><span class="p">]</span> <span class="o">=</span> <span class="kc">False</span>

                <span class="c1">### Affichage du retrait du véhicule</span>

                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">print_in_terminal</span><span class="p">:</span>
                    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Robot </span><span class="si">{</span><span class="n">event</span><span class="o">.</span><span class="n">robot</span><span class="si">}</span><span class="s2"> loads </span><span class="si">{</span><span class="n">moved_vehicle</span><span class="o">.</span><span class="n">id</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
                    <span class="nb">print</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">parking</span><span class="p">)</span>
                    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;&quot;</span><span class="p">)</span>   

        <span class="k">elif</span> <span class="n">block_id</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
            <span class="c1"># Je ne sais pas ce que c&#39;est que ça</span>
            <span class="n">nb_jour</span> <span class="o">=</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">t</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">stock</span><span class="o">.</span><span class="n">first_day</span><span class="p">)</span><span class="o">.</span><span class="n">days</span>
            <span class="k">if</span> <span class="n">nb_jour</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">nb_sortie_interface</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">nb_sortie_interface</span><span class="p">[</span><span class="n">nb_jour</span><span class="p">]</span> <span class="o">+=</span> <span class="mi">1</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">nb_sortie_interface</span><span class="p">[</span><span class="n">nb_jour</span><span class="p">]</span> <span class="o">=</span> <span class="mi">1</span>

        <span class="c1">### Mise à jour des tâches des robots et de la file de priorité</span>
        
        <span class="n">event</span><span class="o">.</span><span class="n">robot</span><span class="o">.</span><span class="n">doing</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">algorithm</span><span class="o">.</span><span class="n">update_robot_arrival</span><span class="p">(</span><span class="n">event</span><span class="o">.</span><span class="n">robot</span><span class="p">,</span> <span class="n">event</span><span class="o">.</span><span class="n">robot</span><span class="o">.</span><span class="n">start_position</span><span class="p">,</span> <span class="n">success</span><span class="p">,</span> <span class="n">moved_vehicle</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">t</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">next_event</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">until</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">repeat</span> <span class="o">=</span> <span class="mi">1</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Exécute un nombre d&#39;évènements égal à repeat</span>
<span class="sd">        Renvoie un couple (bouléen, évènement) heapq</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">event</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="n">r</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="k">while</span> <span class="p">(</span><span class="n">repeat</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">or</span> <span class="n">r</span> <span class="o">&lt;</span> <span class="n">repeat</span><span class="p">)</span> <span class="ow">and</span> <span class="p">(</span><span class="n">until</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">or</span> <span class="n">until</span> <span class="o">&gt;</span> <span class="bp">self</span><span class="o">.</span><span class="n">t</span><span class="p">):</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">events</span><span class="p">:</span>
                <span class="n">time_start</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span>
                <span class="n">event</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">events</span><span class="o">.</span><span class="n">pop</span><span class="p">()</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">t</span> <span class="o">=</span> <span class="n">event</span><span class="o">.</span><span class="n">date</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">nb_events_tracker</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">t</span><span class="p">]</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">events</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="n">event</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">time_execution</span> <span class="o">+=</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span> <span class="o">-</span> <span class="n">time_start</span>
                <span class="n">r</span> <span class="o">+=</span> <span class="mi">1</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">print_in_terminal</span><span class="p">:</span>
                    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;THE SIMULATION IS COMPLETED&quot;</span><span class="p">)</span>  
                <span class="k">break</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">display</span> <span class="ow">and</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">display</span><span class="o">.</span><span class="n">speed</span> <span class="ow">or</span> <span class="n">event</span><span class="o">.</span><span class="n">event_type</span> <span class="ow">not</span> <span class="ow">in</span> <span class="p">[</span><span class="s2">&quot;wake_up_robots_deposit&quot;</span><span class="p">,</span> <span class="s2">&quot;wake_up_robots_retrieval&quot;</span><span class="p">,</span> <span class="s2">&quot;order_deposit&quot;</span><span class="p">,</span> <span class="s2">&quot;order_retrieval&quot;</span><span class="p">])</span> <span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">display</span><span class="o">.</span><span class="n">update</span><span class="p">()</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">display</span><span class="o">.</span><span class="n">time_interval</span> <span class="o">=</span> <span class="mi">0</span><span class="o">*</span><span class="nb">max</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">display</span><span class="o">.</span><span class="n">time_interval</span><span class="o">*</span><span class="mf">0.995</span><span class="p">,</span> <span class="mf">0.1</span><span class="p">)</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">max_t</span><span class="p">:</span>
            <span class="k">return</span> <span class="p">(</span><span class="nb">bool</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">vehicles_left_to_handle</span><span class="p">)</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">t</span> <span class="o">&lt;=</span> <span class="bp">self</span><span class="o">.</span><span class="n">max_t</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">events</span><span class="p">),</span> <span class="n">event</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="p">(</span><span class="nb">bool</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">vehicles_left_to_handle</span><span class="p">)</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">events</span><span class="p">),</span> <span class="n">event</span>
            
    <span class="k">def</span> <span class="nf">complete</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Finit la simulation</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">while</span> <span class="kc">True</span><span class="p">:</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">next_event</span><span class="p">()[</span><span class="mi">0</span><span class="p">]:</span>
                <span class="k">break</span>
        
        <span class="c1"># simulation terminée : on nettoie les dictionnaires d&#39;état du parking et des robots</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">parking</span><span class="o">.</span><span class="n">occupation</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="k">for</span> <span class="n">robot</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">robots</span><span class="p">:</span>
            <span class="n">robot</span> <span class="o">=</span> <span class="n">Robot</span><span class="p">(</span><span class="n">robot</span><span class="o">.</span><span class="n">id_robot</span><span class="p">)</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">print_in_terminal</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Temps d&#39;exécution : </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">time_execution</span><span class="si">:</span><span class="s2">.2f</span><span class="si">}</span><span class="s2">s&quot;</span><span class="p">)</span>
    
    <span class="k">def</span> <span class="nf">start_display</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">place_width</span><span class="o">=</span><span class="mi">15</span><span class="p">,</span> <span class="n">place_length</span><span class="o">=</span><span class="mi">20</span><span class="p">,</span> <span class="n">time_interval</span><span class="o">=</span><span class="mf">0.</span><span class="p">):</span>
        <span class="n">Display</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">place_width</span><span class="p">,</span> <span class="n">place_length</span><span class="p">,</span> <span class="n">time_interval</span><span class="p">)</span>


<span class="k">class</span> <span class="nc">Event</span><span class="p">():</span>

    <span class="n">next_id</span> <span class="o">=</span> <span class="mi">0</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">vehicle</span><span class="p">,</span> <span class="n">date</span><span class="p">,</span> <span class="n">event_type</span><span class="p">,</span> <span class="n">robot</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">unassigned_tasks</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">goal_position</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">event_retrieval</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Les valeurs possibles du string event_type sont :</span>
<span class="sd">        - &#39;order_deposit&#39;</span>
<span class="sd">        - &#39;order_retrieval&#39;</span>
<span class="sd">        - &#39;deposit&#39;</span>
<span class="sd">        - &#39;retrieval&#39;</span>
<span class="sd">        - &#39;robot_arrrival&#39;</span>
<span class="sd">        - &#39;wake_up_robots_retrieval&#39;</span>
<span class="sd">        - &#39;wake_up_robots&#39;</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">vehicle</span> <span class="o">=</span> <span class="n">vehicle</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">date</span> <span class="o">=</span> <span class="n">date</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">event_type</span> <span class="o">=</span> <span class="n">event_type</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">robot</span> <span class="o">=</span> <span class="n">robot</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">unassigned_tasks</span> <span class="o">=</span> <span class="n">unassigned_tasks</span> <span class="c1"># No longer used</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">goal_position</span> <span class="o">=</span> <span class="n">goal_position</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">canceled</span> <span class="o">=</span> <span class="kc">False</span> <span class="c1"># Not usedd</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">event_retrieval</span> <span class="o">=</span> <span class="n">event_retrieval</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">id</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="vm">__class__</span><span class="o">.</span><span class="n">next_id</span>
        <span class="bp">self</span><span class="o">.</span><span class="vm">__class__</span><span class="o">.</span><span class="n">next_id</span> <span class="o">+=</span> <span class="mi">1</span>
    
    <span class="k">def</span> <span class="fm">__bool__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="kc">True</span>

    <span class="k">def</span> <span class="fm">__eq__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">):</span>
        <span class="k">if</span> <span class="bp">self</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">or</span> <span class="n">other</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">return</span> <span class="kc">False</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">id</span> <span class="o">==</span> <span class="n">other</span><span class="o">.</span><span class="n">id</span>

    <span class="k">def</span> <span class="fm">__lt__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">):</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">date</span> <span class="o">==</span> <span class="n">other</span><span class="o">.</span><span class="n">date</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">id</span> <span class="o">&gt;</span> <span class="n">other</span><span class="o">.</span><span class="n">id</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">date</span> <span class="o">&gt;</span> <span class="n">other</span><span class="o">.</span><span class="n">date</span>
    
    <span class="k">def</span> <span class="fm">__repr__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">robot</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span> 
            <span class="k">return</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">event_type</span><span class="si">}</span><span class="s2"> ; due to </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">date</span><span class="si">}</span><span class="s2"> ; vehicle </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">vehicle</span><span class="si">}</span><span class="s2"> ; concerning robot </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">robot</span><span class="o">.</span><span class="n">id_robot</span><span class="si">}</span><span class="s2">&quot;</span>
        <span class="k">else</span><span class="p">:</span> 
            <span class="k">return</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">event_type</span><span class="si">}</span><span class="s2"> ; due to </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">date</span><span class="si">}</span><span class="s2"> ; vehicle </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">vehicle</span><span class="si">}</span><span class="s2">&quot;</span>


<span class="k">class</span> <span class="nc">Algorithm</span><span class="p">():</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">simulation</span><span class="p">,</span> <span class="n">t0</span><span class="p">,</span> <span class="n">stock</span><span class="p">,</span> <span class="n">robots</span><span class="p">,</span> <span class="n">parking</span><span class="p">,</span> <span class="n">events</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="n">print_in_terminal</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">simulation</span> <span class="o">=</span> <span class="n">simulation</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">robots</span> <span class="o">=</span> <span class="n">robots</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">stock</span> <span class="o">=</span> <span class="n">stock</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">t0</span> <span class="o">=</span> <span class="n">t0</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">parking</span> <span class="o">=</span> <span class="n">parking</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">events</span> <span class="o">=</span> <span class="n">events</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">print_in_terminal</span> <span class="o">=</span> <span class="n">print_in_terminal</span>

        <span class="c1">#paramètres liés à la mesure de la performance de l&#39;algorithme</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">nb_placements</span> <span class="o">=</span> <span class="mi">0</span>
    
    <span class="k">def</span> <span class="nf">update</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">current_time</span><span class="p">):</span>
        <span class="k">pass</span>
    
    <span class="k">def</span> <span class="nf">update_deposit</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">vehicle</span><span class="p">,</span> <span class="n">success</span><span class="p">,</span> <span class="n">current_time</span><span class="p">):</span>
        <span class="k">pass</span>

    <span class="k">def</span> <span class="nf">update_retrieval</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">vehicle</span><span class="p">,</span> <span class="n">success</span><span class="p">,</span> <span class="n">current_time</span><span class="p">):</span>
        <span class="k">pass</span>

    <span class="k">def</span> <span class="nf">update_robot_arrival</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">robot</span><span class="p">,</span> <span class="n">lane_end</span><span class="p">,</span> <span class="n">success</span><span class="p">,</span> <span class="n">moved_vehicle</span><span class="p">,</span> <span class="n">current_time</span><span class="p">):</span>
        <span class="k">pass</span>

    <span class="k">def</span> <span class="nf">update_robot_end_task</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">robot</span><span class="p">,</span> <span class="n">lane_end</span><span class="p">,</span> <span class="n">success</span><span class="p">,</span> <span class="n">current_time</span><span class="p">):</span>
        <span class="k">pass</span>

    <span class="k">def</span> <span class="nf">update_start</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">pass</span>


<div class="viewcode-block" id="BaseAlgorithm"><a class="viewcode-back" href="../index.html#simulation.BaseAlgorithm">[docs]</a><span class="k">class</span> <span class="nc">BaseAlgorithm</span><span class="p">(</span><span class="n">Algorithm</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Un BaseAlgorithm comporte une méthode assign_task qui attribue à un robot une tâche lorsqu&#39;il n&#39;a plus rien à faire</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">simulation</span><span class="p">,</span> <span class="n">t0</span><span class="p">,</span> <span class="n">stock</span><span class="p">,</span> <span class="n">robots</span><span class="p">,</span> <span class="n">parking</span><span class="p">,</span> <span class="n">events</span><span class="p">,</span> <span class="n">locked_lanes</span><span class="p">,</span> <span class="n">pending_retrievals</span><span class="p">,</span> <span class="n">anticipation_time</span><span class="o">=</span><span class="n">datetime</span><span class="o">.</span><span class="n">timedelta</span><span class="p">(</span><span class="n">hours</span><span class="o">=</span><span class="mi">8</span><span class="p">),</span> <span class="n">print_in_terminal</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>

        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="n">simulation</span><span class="p">,</span> <span class="n">t0</span><span class="p">,</span> <span class="n">stock</span><span class="p">,</span> <span class="n">robots</span><span class="p">,</span> <span class="n">parking</span><span class="p">,</span> <span class="n">events</span><span class="p">,</span> <span class="n">print_in_terminal</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">locked_lanes</span> <span class="o">=</span> <span class="n">locked_lanes</span>
        <span class="c1"># Pour chaque véhicule, le côté de sa lane choisi pour le récupérer</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">side_chosen_to_retrieve</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">pending_retrievals</span> <span class="o">=</span> <span class="n">pending_retrievals</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">anticipation_time</span> <span class="o">=</span> <span class="n">anticipation_time</span>

        <span class="c1">#paramètres liés à la mesure de la performance de l&#39;algorithme</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">nb_placements</span> <span class="o">=</span> <span class="mi">0</span>
    

<div class="viewcode-block" id="BaseAlgorithm.assign_task"><a class="viewcode-back" href="../index.html#simulation.BaseAlgorithm.assign_task">[docs]</a>    <span class="k">def</span> <span class="nf">assign_task</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">robot</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Assigne une tâche à un robot</span>

<span class="sd">        :param robot: Un robot sans tâche</span>
<span class="sd">        :type robot: Robot</span>
<span class="sd">        :return: None si aucune tâche n&#39;a été trouvée, l&#39;event correspondant à la tâche sinon.</span>
<span class="sd">        :rtype: Event</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="n">retrieval_event</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">find_unassigned_retrieval</span><span class="p">()</span>
        <span class="n">deposit_event</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">find_unassigned_deposit</span><span class="p">()</span>

        <span class="c1"># on vérifie qu&#39;il y a bien des choses à faire</span>
        <span class="k">if</span> <span class="n">retrieval_event</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">and</span> <span class="n">deposit_event</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">return</span> <span class="kc">None</span>

        <span class="c1"># sinon il y a des choses à faire : on choisi entre un deposit et un retrieval</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">isRetrievalBetterThanDeposit</span><span class="p">(</span><span class="n">retrieval_event</span><span class="o">=</span><span class="n">retrieval_event</span><span class="p">,</span> <span class="n">deposit_event</span><span class="o">=</span><span class="n">deposit_event</span><span class="p">)</span> <span class="p">:</span>    <span class="c1"># on juge plus important de sortir un véhicule que d&#39;en placer un</span>

            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">print_in_terminal</span><span class="p">:</span>
                <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot; -&gt; event </span><span class="si">{</span><span class="n">retrieval_event</span><span class="si">}</span><span class="s2"> assigned to </span><span class="si">{</span><span class="n">robot</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

            <span class="c1"># on récupère la position du véhicule que l&#39;on va chercher à placer</span>
            <span class="n">block_id</span><span class="p">,</span> <span class="n">lane_id</span><span class="p">,</span> <span class="n">position</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">parking</span><span class="o">.</span><span class="n">occupation</span><span class="p">[</span><span class="n">retrieval_event</span><span class="o">.</span><span class="n">vehicle</span><span class="o">.</span><span class="n">id</span><span class="p">]</span>
            <span class="n">lane_vehicle</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">parking</span><span class="o">.</span><span class="n">blocks</span><span class="p">[</span><span class="n">block_id</span><span class="p">]</span><span class="o">.</span><span class="n">lanes</span><span class="p">[</span><span class="n">lane_id</span><span class="p">]</span>

            <span class="c1"># on détermine par quel côté le véhicule doit sortir</span>
            <span class="k">if</span> <span class="n">lane_vehicle</span><span class="o">.</span><span class="n">bottom_access</span> <span class="ow">and</span> <span class="n">lane_vehicle</span><span class="o">.</span><span class="n">bottom_position</span> <span class="o">-</span> <span class="n">position</span> <span class="o">&lt;</span> <span class="n">position</span> <span class="o">-</span> <span class="n">lane_vehicle</span><span class="o">.</span><span class="n">top_position</span><span class="p">:</span>
                <span class="n">side</span> <span class="o">=</span> <span class="s2">&quot;bottom&quot;</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">side</span> <span class="o">=</span> <span class="s2">&quot;top&quot;</span>

            <span class="c1"># mise à jour des positions actuelle et d&#39;arrivée du robot</span>
            <span class="n">robot</span><span class="o">.</span><span class="n">start_position</span> <span class="o">=</span> <span class="n">robot</span><span class="o">.</span><span class="n">goal_position</span>
            <span class="n">robot</span><span class="o">.</span><span class="n">goal_position</span> <span class="o">=</span> <span class="p">(</span><span class="n">block_id</span><span class="p">,</span> <span class="n">lane_id</span><span class="p">,</span> <span class="n">side</span><span class="p">)</span>
            <span class="c1"># on informe qu&#39;on est en train de retirer ce véhicule</span>
            <span class="n">lane_vehicle</span><span class="o">.</span><span class="n">pop_reserve</span><span class="p">(</span><span class="n">side</span><span class="p">)</span>

            <span class="c1"># mise à jour des dates actuelle et d&#39;arrivée du robot</span>
            <span class="n">robot</span><span class="o">.</span><span class="n">start_time</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">simulation</span><span class="o">.</span><span class="n">t</span>
            <span class="n">robot</span><span class="o">.</span><span class="n">goal_time</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">simulation</span><span class="o">.</span><span class="n">t</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">parking</span><span class="o">.</span><span class="n">travel_time</span><span class="p">(</span><span class="n">robot</span><span class="o">.</span><span class="n">start_position</span><span class="p">,</span> <span class="n">robot</span><span class="o">.</span><span class="n">goal_position</span><span class="p">)</span>

            <span class="c1"># affectation du robot à l&#39;évènement</span>
            <span class="n">retrieval_event</span><span class="o">.</span><span class="n">robot</span> <span class="o">=</span> <span class="n">robot</span>
            <span class="c1"># création de l&#39;event d&#39;arrivée</span>
            <span class="n">event_arrival</span> <span class="o">=</span> <span class="n">Event</span><span class="p">(</span><span class="n">retrieval_event</span><span class="o">.</span><span class="n">vehicle</span><span class="p">,</span> <span class="n">robot</span><span class="o">.</span><span class="n">goal_time</span><span class="p">,</span> <span class="s2">&quot;robot_arrival&quot;</span><span class="p">,</span> <span class="n">robot</span><span class="p">)</span>
            <span class="c1"># ajout de l&#39;event à la pile des events</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">events</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">event_arrival</span><span class="p">)</span>

            <span class="n">robot</span><span class="o">.</span><span class="n">doing</span> <span class="o">=</span> <span class="n">event_arrival</span>     <span class="c1"># event en cours</span>
            <span class="c1"># Utilisé pour contrôler ce que fait le robot</span>
            <span class="n">robot</span><span class="o">.</span><span class="n">target</span> <span class="o">=</span> <span class="n">retrieval_event</span>

            <span class="k">return</span> <span class="n">retrieval_event</span>
        
        <span class="k">else</span><span class="p">:</span>   <span class="c1"># on juge plus important de placer un véhicule que d&#39;en sortir un</span>
            
            <span class="c1"># récupération de la position du véhicule à placer</span>
            <span class="n">lane_id</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">parking</span><span class="o">.</span><span class="n">occupation</span><span class="p">[</span><span class="n">deposit_event</span><span class="o">.</span><span class="n">vehicle</span><span class="o">.</span><span class="n">id</span><span class="p">][</span><span class="mi">1</span><span class="p">]</span>
            <span class="n">lane</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">parking</span><span class="o">.</span><span class="n">blocks</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">lanes</span><span class="p">[</span><span class="n">lane_id</span><span class="p">]</span>
            
            <span class="c1"># mise à jour des positions actuelle et cible du robot</span>
            <span class="n">robot</span><span class="o">.</span><span class="n">start_position</span> <span class="o">=</span> <span class="n">robot</span><span class="o">.</span><span class="n">goal_position</span>
            <span class="n">robot</span><span class="o">.</span><span class="n">goal_position</span> <span class="o">=</span> <span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">lane_id</span><span class="p">,</span> <span class="s2">&quot;bottom&quot;</span><span class="p">)</span>
            <span class="c1"># on informe qu&#39;on est en train de retirer ce véhicule</span>
            <span class="n">lane</span><span class="o">.</span><span class="n">pop_reserve</span><span class="p">(</span><span class="s2">&quot;bottom&quot;</span><span class="p">)</span>

            <span class="c1"># mise à jour des dates actuelle et d&#39;arrivée du robot</span>
            <span class="n">robot</span><span class="o">.</span><span class="n">start_time</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">simulation</span><span class="o">.</span><span class="n">t</span>
            <span class="n">robot</span><span class="o">.</span><span class="n">goal_time</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">simulation</span><span class="o">.</span><span class="n">t</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">parking</span><span class="o">.</span><span class="n">travel_time</span><span class="p">((</span><span class="mi">0</span><span class="p">,</span> <span class="n">lane_id</span><span class="p">,</span> <span class="s2">&quot;bottom&quot;</span><span class="p">),</span> <span class="n">robot</span><span class="o">.</span><span class="n">goal_position</span><span class="p">)</span>
            <span class="c1"># création de l&#39;event d&#39;arrivée (sur l&#39;interface pour récupération)</span>
            <span class="n">event_arrival</span> <span class="o">=</span> <span class="n">Event</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">stock</span><span class="o">.</span><span class="n">vehicles</span><span class="p">[</span><span class="n">deposit_event</span><span class="o">.</span><span class="n">vehicle</span><span class="o">.</span><span class="n">id</span><span class="p">],</span> <span class="n">robot</span><span class="o">.</span><span class="n">goal_time</span><span class="p">,</span> <span class="s2">&quot;robot_arrival&quot;</span><span class="p">,</span> <span class="n">robot</span><span class="p">)</span>
            <span class="c1"># ajout de l&#39;event à la pile des events</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">events</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">event_arrival</span><span class="p">)</span>
            <span class="n">robot</span><span class="o">.</span><span class="n">doing</span> <span class="o">=</span> <span class="n">event_arrival</span>     <span class="c1"># event en cours</span>

            <span class="c1"># Utilisé pour contrôler ce que fait le robot</span>
            <span class="n">robot</span><span class="o">.</span><span class="n">target</span> <span class="o">=</span> <span class="n">deposit_event</span>

            <span class="c1"># on déclare que la lane est ciblée pour éviter qu&#39;un autre robot ne vienne chercher le même véhicule</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">parking</span><span class="o">.</span><span class="n">blocks</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">targeted</span><span class="p">[</span><span class="n">lane_id</span><span class="p">]</span> <span class="o">=</span> <span class="kc">True</span>
            
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">print_in_terminal</span><span class="p">:</span>
                <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot; -&gt; event </span><span class="si">{</span><span class="n">deposit_event</span><span class="si">}</span><span class="s2"> assigned to </span><span class="si">{</span><span class="n">robot</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
            <span class="k">return</span> <span class="n">deposit_event</span></div>
        

<div class="viewcode-block" id="BaseAlgorithm.find_unassigned_retrieval"><a class="viewcode-back" href="../index.html#simulation.BaseAlgorithm.find_unassigned_retrieval">[docs]</a>    <span class="k">def</span> <span class="nf">find_unassigned_retrieval</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Choisit, s&#39;il y en a un, le retrieval à faire en priorité</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># On verifie d&#39;abord si des retrievals sont en retard</span>
        <span class="n">i</span> <span class="o">=</span> <span class="mi">1</span>
        <span class="k">while</span> <span class="n">i</span> <span class="o">&lt;=</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">pending_retrievals</span><span class="p">):</span>
            <span class="n">event</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">pending_retrievals</span><span class="p">[</span><span class="o">-</span><span class="n">i</span><span class="p">]</span>
            <span class="k">if</span> <span class="n">event</span><span class="o">.</span><span class="n">vehicle</span><span class="o">.</span><span class="n">id</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">parking</span><span class="o">.</span><span class="n">occupation</span><span class="p">:</span>
                <span class="n">block_id</span><span class="p">,</span> <span class="n">lane_id</span><span class="p">,</span> <span class="n">position</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">parking</span><span class="o">.</span><span class="n">occupation</span><span class="p">[</span><span class="n">event</span><span class="o">.</span><span class="n">vehicle</span><span class="o">.</span><span class="n">id</span><span class="p">]</span>
                <span class="k">if</span> <span class="n">block_id</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">:</span>
                    <span class="n">lane</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">parking</span><span class="o">.</span><span class="n">blocks</span><span class="p">[</span><span class="n">block_id</span><span class="p">]</span><span class="o">.</span><span class="n">lanes</span><span class="p">[</span><span class="n">lane_id</span><span class="p">]</span>
                    <span class="k">try</span><span class="p">:</span>
                        <span class="n">future_lane</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">parking</span><span class="o">.</span><span class="n">future_config</span><span class="p">(</span><span class="n">lane</span><span class="p">,</span> <span class="n">block_id</span><span class="p">,</span> <span class="n">lane_id</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">robots</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">stock</span><span class="p">)</span>
                        <span class="k">if</span> <span class="n">future_lane</span><span class="o">.</span><span class="n">list_vehicles</span><span class="p">[</span><span class="n">position</span><span class="p">]</span> <span class="o">==</span> <span class="n">event</span><span class="o">.</span><span class="n">vehicle</span><span class="o">.</span><span class="n">id</span><span class="p">:</span>
                            <span class="k">return</span> <span class="n">event</span>
                    <span class="k">except</span> <span class="ne">IndexError</span><span class="p">:</span>
                        <span class="k">pass</span>
            <span class="n">i</span> <span class="o">+=</span> <span class="mi">1</span>

        <span class="c1"># On s&#39;intéresse ensuite aux retrievals qui sont prévus dans moins d&#39;une heure</span>
        <span class="n">i</span> <span class="o">=</span> <span class="mi">1</span>
        <span class="k">while</span> <span class="n">i</span> <span class="o">&lt;=</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">events</span><span class="p">):</span>
            <span class="n">event</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">events</span><span class="p">[</span><span class="o">-</span><span class="n">i</span><span class="p">]</span>
            <span class="k">if</span> <span class="n">event</span><span class="o">.</span><span class="n">date</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">simulation</span><span class="o">.</span><span class="n">t</span> <span class="o">&gt;</span> <span class="bp">self</span><span class="o">.</span><span class="n">anticipation_time</span><span class="p">:</span>
                <span class="k">break</span>
            <span class="k">if</span> <span class="n">event</span><span class="o">.</span><span class="n">event_type</span> <span class="o">==</span> <span class="s2">&quot;retrieval&quot;</span> <span class="ow">and</span> <span class="n">event</span><span class="o">.</span><span class="n">vehicle</span><span class="o">.</span><span class="n">id</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">parking</span><span class="o">.</span><span class="n">occupation</span><span class="p">:</span>
                <span class="n">block_id</span><span class="p">,</span> <span class="n">lane_id</span><span class="p">,</span> <span class="n">position</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">parking</span><span class="o">.</span><span class="n">occupation</span><span class="p">[</span><span class="n">event</span><span class="o">.</span><span class="n">vehicle</span><span class="o">.</span><span class="n">id</span><span class="p">]</span>
                <span class="k">if</span> <span class="n">block_id</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">:</span>
                    <span class="n">lane</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">parking</span><span class="o">.</span><span class="n">blocks</span><span class="p">[</span><span class="n">block_id</span><span class="p">]</span><span class="o">.</span><span class="n">lanes</span><span class="p">[</span><span class="n">lane_id</span><span class="p">]</span>
                    <span class="k">try</span><span class="p">:</span>
                        <span class="n">future_lane</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">parking</span><span class="o">.</span><span class="n">future_config</span><span class="p">(</span><span class="n">lane</span><span class="p">,</span> <span class="n">block_id</span><span class="p">,</span> <span class="n">lane_id</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">robots</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">stock</span><span class="p">)</span>
                        <span class="k">if</span> <span class="n">future_lane</span><span class="o">.</span><span class="n">list_vehicles</span><span class="p">[</span><span class="n">position</span><span class="p">]</span> <span class="o">==</span> <span class="n">event</span><span class="o">.</span><span class="n">vehicle</span><span class="o">.</span><span class="n">id</span><span class="p">:</span>
                            <span class="k">return</span> <span class="n">event</span>
                    <span class="k">except</span> <span class="ne">IndexError</span><span class="p">:</span>
                        <span class="k">pass</span>
            <span class="n">i</span> <span class="o">+=</span> <span class="mi">1</span></div>
    
<div class="viewcode-block" id="BaseAlgorithm.find_unassigned_deposit"><a class="viewcode-back" href="../index.html#simulation.BaseAlgorithm.find_unassigned_deposit">[docs]</a>    <span class="k">def</span> <span class="nf">find_unassigned_deposit</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Choisit, s&#39;il y en a un, le deposit à faire en priorité</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># on parcours toutes les places de l&#39;interface pour voir si il y a un véhicule à placer</span>
        <span class="k">for</span> <span class="n">lane_id</span><span class="p">,</span> <span class="n">lane</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">parking</span><span class="o">.</span><span class="n">blocks</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">lanes</span><span class="p">):</span>
            <span class="c1"># on vérifie qu&#39;il y a bien un véhicule dans la place d&#39;interface considérée et qu&#39;il n&#39;est pas déjà ciblé par un autre robot </span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">lane</span><span class="o">.</span><span class="n">list_vehicles</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="ow">in</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="s2">&quot;Lock&quot;</span><span class="p">]</span> <span class="ow">and</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">parking</span><span class="o">.</span><span class="n">blocks</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">targeted</span><span class="p">[</span><span class="n">lane_id</span><span class="p">]:</span>
                <span class="c1"># on récupère le véhicule que l&#39;on va chercher à placer</span>
                <span class="n">vehicle</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">stock</span><span class="o">.</span><span class="n">vehicles</span><span class="p">[</span><span class="n">lane</span><span class="o">.</span><span class="n">list_vehicles</span><span class="p">[</span><span class="mi">0</span><span class="p">]]</span>
                <span class="c1"># on vérifie que le véhicule ne va pas être récupérer par le client bientôt (et qu&#39;il est en cours de sortie)</span>
                <span class="k">if</span> <span class="n">vehicle</span><span class="o">.</span><span class="n">order_retrieval</span> <span class="o">&gt;</span> <span class="bp">self</span><span class="o">.</span><span class="n">simulation</span><span class="o">.</span><span class="n">t</span> <span class="ow">or</span> <span class="n">vehicle</span><span class="o">.</span><span class="n">retrieval</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">simulation</span><span class="o">.</span><span class="n">t</span> <span class="o">&gt;</span> <span class="bp">self</span><span class="o">.</span><span class="n">anticipation_time</span><span class="p">:</span>
                    <span class="n">deposit_event</span> <span class="o">=</span> <span class="n">Event</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">stock</span><span class="o">.</span><span class="n">vehicles</span><span class="p">[</span><span class="n">vehicle</span><span class="o">.</span><span class="n">id</span><span class="p">],</span> <span class="n">vehicle</span><span class="o">.</span><span class="n">deposit</span><span class="p">,</span> <span class="s2">&quot;empty_interface&quot;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
                    <span class="k">return</span> <span class="n">deposit_event</span></div>

    <span class="k">def</span> <span class="nf">place</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">):</span>
        <span class="k">return</span> <span class="p">(</span><span class="kc">None</span><span class="p">,</span> <span class="kc">None</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">check_pick</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">lane_end</span><span class="p">,</span> <span class="n">moved_vehicle</span><span class="p">,</span> <span class="n">current_time</span><span class="p">):</span>
        <span class="n">block_id</span><span class="p">,</span> <span class="n">lane_id</span><span class="p">,</span> <span class="n">side</span> <span class="o">=</span> <span class="n">lane_end</span> <span class="c1"># datetime.timedelta</span>
        <span class="k">if</span> <span class="n">moved_vehicle</span><span class="o">.</span><span class="n">order_retrieval</span> <span class="o">&lt;=</span> <span class="n">current_time</span> <span class="ow">and</span> <span class="n">moved_vehicle</span><span class="o">.</span><span class="n">retrieval</span> <span class="o">-</span> <span class="n">current_time</span> <span class="o">&lt;</span> <span class="bp">self</span><span class="o">.</span><span class="n">anticipation_time</span><span class="p">:</span>
            <span class="n">i_lane</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">parking</span><span class="o">.</span><span class="n">blocks</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">empty_lane</span><span class="p">()</span>
            <span class="k">if</span> <span class="n">i_lane</span> <span class="o">==</span> <span class="s2">&quot;full&quot;</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">parking</span><span class="o">.</span><span class="n">blocks</span><span class="p">[</span><span class="n">block_id</span><span class="p">]</span><span class="o">.</span><span class="n">lanes</span><span class="p">[</span><span class="n">lane_id</span><span class="p">]</span><span class="o">.</span><span class="n">pop_cancel_reserve</span><span class="p">(</span><span class="n">side</span><span class="p">)</span>
                <span class="k">return</span> <span class="kc">False</span>
        <span class="k">return</span> <span class="kc">True</span>

<div class="viewcode-block" id="BaseAlgorithm.check_redirections"><a class="viewcode-back" href="../index.html#simulation.BaseAlgorithm.check_redirections">[docs]</a>    <span class="k">def</span> <span class="nf">check_redirections</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">event</span><span class="p">,</span> <span class="n">current_time</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        S&#39;exécute lorsque l&#39;algorithme est notifié d&#39;un futur retrieval</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># Si un robot est en train de transporter un véhicule cible d&#39;un retrieval</span>
        <span class="k">for</span> <span class="n">robot</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">robots</span><span class="p">:</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="p">(</span><span class="n">robot</span><span class="o">.</span><span class="n">vehicle</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">)</span> <span class="ow">and</span> <span class="n">robot</span><span class="o">.</span><span class="n">vehicle</span><span class="o">.</span><span class="n">id</span> <span class="o">==</span> <span class="n">event</span><span class="o">.</span><span class="n">vehicle</span><span class="o">.</span><span class="n">id</span><span class="p">:</span>
                <span class="n">i_lane</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">parking</span><span class="o">.</span><span class="n">blocks</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">empty_lane</span><span class="p">()</span>
                <span class="k">if</span> <span class="n">i_lane</span> <span class="o">!=</span> <span class="s2">&quot;full&quot;</span><span class="p">:</span>
                    <span class="n">block_id</span><span class="p">,</span> <span class="n">lane_id</span><span class="p">,</span> <span class="n">side</span> <span class="o">=</span> <span class="n">robot</span><span class="o">.</span><span class="n">goal_position</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">parking</span><span class="o">.</span><span class="n">blocks</span><span class="p">[</span><span class="n">block_id</span><span class="p">]</span><span class="o">.</span><span class="n">lanes</span><span class="p">[</span><span class="n">lane_id</span><span class="p">]</span><span class="o">.</span><span class="n">push_cancel_reserve</span><span class="p">(</span><span class="n">side</span><span class="p">)</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">parking</span><span class="o">.</span><span class="n">blocks</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">lanes</span><span class="p">[</span><span class="n">i_lane</span><span class="p">]</span><span class="o">.</span><span class="n">push_reserve</span><span class="p">(</span><span class="n">robot</span><span class="o">.</span><span class="n">vehicle</span><span class="o">.</span><span class="n">id</span><span class="p">,</span> <span class="s2">&quot;bottom&quot;</span><span class="p">,</span> <span class="n">mark</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">parking</span><span class="o">.</span><span class="n">blocks</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">lanes</span><span class="p">[</span><span class="n">i_lane</span><span class="p">]</span><span class="o">.</span><span class="n">list_vehicles</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;Lock&quot;</span>
                    <span class="c1">#On place le vehicule a l&#39;interface</span>
                    <span class="n">robot</span><span class="o">.</span><span class="n">goal_position</span> <span class="o">=</span> <span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">i_lane</span><span class="p">,</span> <span class="s2">&quot;bottom&quot;</span><span class="p">)</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">parking</span><span class="o">.</span><span class="n">blocks</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">nb_places_available</span> <span class="o">-=</span> <span class="mi">1</span>
                    <span class="c1"># Calcul du temps de trajet faux</span>
                    <span class="n">robot</span><span class="o">.</span><span class="n">goal_time</span> <span class="o">=</span> <span class="n">current_time</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">parking</span><span class="o">.</span><span class="n">travel_time</span><span class="p">(</span><span class="n">robot</span><span class="o">.</span><span class="n">start_position</span><span class="p">,</span> <span class="n">robot</span><span class="o">.</span><span class="n">goal_position</span><span class="p">)</span>
                    <span class="n">robot</span><span class="o">.</span><span class="n">target</span> <span class="o">=</span> <span class="n">event</span><span class="o">.</span><span class="n">event_retrieval</span>
                    <span class="n">event</span><span class="o">.</span><span class="n">event_retrieval</span><span class="o">.</span><span class="n">unassigned_tasks</span> <span class="o">=</span> <span class="mi">0</span>
                    
                    <span class="n">event_end_task</span> <span class="o">=</span> <span class="n">Event</span><span class="p">(</span><span class="n">robot</span><span class="o">.</span><span class="n">vehicle</span><span class="p">,</span> <span class="n">robot</span><span class="o">.</span><span class="n">goal_time</span><span class="p">,</span> <span class="s2">&quot;robot_end_task&quot;</span><span class="p">,</span> <span class="n">robot</span><span class="p">)</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">events</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">event_end_task</span><span class="p">)</span>

                    <span class="n">robot</span><span class="o">.</span><span class="n">doing</span><span class="o">.</span><span class="n">canceled</span> <span class="o">=</span> <span class="kc">True</span>
                    <span class="n">robot</span><span class="o">.</span><span class="n">doing</span> <span class="o">=</span> <span class="n">event_end_task</span>
                
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">block_id</span><span class="p">,</span> <span class="n">lane_id</span><span class="p">,</span> <span class="n">side</span> <span class="o">=</span> <span class="n">robot</span><span class="o">.</span><span class="n">goal_position</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">locked_lanes</span><span class="p">[(</span><span class="n">block_id</span><span class="p">,</span> <span class="n">lane_id</span><span class="p">,</span> <span class="n">side</span><span class="p">)]</span> <span class="o">+=</span> <span class="mi">1</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">side_chosen_to_retrieve</span><span class="p">[</span><span class="n">robot</span><span class="o">.</span><span class="n">vehicle</span><span class="o">.</span><span class="n">id</span><span class="p">]</span> <span class="o">=</span> <span class="n">side</span>

                    <span class="c1"># Si un robot voulait placer un véhicule dans la lane et le côté par lequel on veut sortir le véhicule cible du retrieval</span>
                    <span class="k">for</span> <span class="n">robot</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">robots</span><span class="p">:</span>
                        <span class="k">if</span> <span class="ow">not</span> <span class="p">(</span><span class="n">robot</span><span class="o">.</span><span class="n">vehicle</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">)</span> <span class="ow">and</span> <span class="n">robot</span><span class="o">.</span><span class="n">doing</span> <span class="ow">and</span> <span class="n">robot</span><span class="o">.</span><span class="n">goal_position</span> <span class="o">==</span> <span class="p">(</span><span class="n">block_id</span><span class="p">,</span> <span class="n">lane_id</span><span class="p">,</span> <span class="n">side</span><span class="p">):</span>
                            <span class="bp">self</span><span class="o">.</span><span class="n">parking</span><span class="o">.</span><span class="n">blocks</span><span class="p">[</span><span class="n">block_id</span><span class="p">]</span><span class="o">.</span><span class="n">lanes</span><span class="p">[</span><span class="n">lane_id</span><span class="p">]</span><span class="o">.</span><span class="n">push_cancel_reserve</span><span class="p">(</span><span class="n">side</span><span class="p">)</span>
                            <span class="n">robot</span><span class="o">.</span><span class="n">goal_position</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">place</span><span class="p">(</span><span class="n">robot</span><span class="o">.</span><span class="n">vehicle</span><span class="p">,</span> <span class="n">robot</span><span class="o">.</span><span class="n">start_position</span><span class="p">,</span> <span class="n">current_time</span><span class="p">)</span>
                            <span class="c1"># Calcul du temps de trajet faux</span>
                            <span class="n">robot</span><span class="o">.</span><span class="n">goal_time</span>  <span class="o">=</span> <span class="n">current_time</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">parking</span><span class="o">.</span><span class="n">travel_time</span><span class="p">(</span><span class="n">robot</span><span class="o">.</span><span class="n">start_position</span><span class="p">,</span> <span class="n">robot</span><span class="o">.</span><span class="n">goal_position</span><span class="p">)</span>
                            <span class="n">event_end_task</span> <span class="o">=</span> <span class="n">Event</span><span class="p">(</span><span class="n">robot</span><span class="o">.</span><span class="n">vehicle</span><span class="p">,</span> <span class="n">robot</span><span class="o">.</span><span class="n">goal_time</span><span class="p">,</span> <span class="s2">&quot;robot_end_task&quot;</span><span class="p">,</span> <span class="n">robot</span><span class="p">)</span>
                            <span class="bp">self</span><span class="o">.</span><span class="n">events</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">event_end_task</span><span class="p">)</span>

                            <span class="n">robot</span><span class="o">.</span><span class="n">doing</span><span class="o">.</span><span class="n">canceled</span> <span class="o">=</span> <span class="kc">True</span>
                            <span class="n">robot</span><span class="o">.</span><span class="n">doing</span> <span class="o">=</span> <span class="n">event_end_task</span>


        <span class="c1"># Si un véhicule cible d&#39;un retrieval est garé sur le parking</span>
        <span class="k">if</span> <span class="n">event</span><span class="o">.</span><span class="n">vehicle</span><span class="o">.</span><span class="n">id</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">parking</span><span class="o">.</span><span class="n">occupation</span><span class="p">:</span>
            <span class="n">block_id</span><span class="p">,</span> <span class="n">lane_id</span><span class="p">,</span> <span class="n">position</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">parking</span><span class="o">.</span><span class="n">occupation</span><span class="p">[</span><span class="n">event</span><span class="o">.</span><span class="n">vehicle</span><span class="o">.</span><span class="n">id</span><span class="p">]</span>
            <span class="k">if</span> <span class="n">block_id</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">:</span>
                <span class="n">vehicle_lane</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">parking</span><span class="o">.</span><span class="n">blocks</span><span class="p">[</span><span class="n">block_id</span><span class="p">]</span><span class="o">.</span><span class="n">lanes</span><span class="p">[</span><span class="n">lane_id</span><span class="p">]</span>
                <span class="k">if</span> <span class="n">vehicle_lane</span><span class="o">.</span><span class="n">bottom_access</span> <span class="ow">and</span> <span class="n">vehicle_lane</span><span class="o">.</span><span class="n">bottom_position</span> <span class="o">-</span> <span class="n">position</span> <span class="o">&lt;</span> <span class="n">position</span> <span class="o">-</span> <span class="n">vehicle_lane</span><span class="o">.</span><span class="n">top_position</span><span class="p">:</span>
                    <span class="n">side</span> <span class="o">=</span> <span class="s2">&quot;bottom&quot;</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">side</span> <span class="o">=</span> <span class="s2">&quot;top&quot;</span>
                
                <span class="bp">self</span><span class="o">.</span><span class="n">locked_lanes</span><span class="p">[(</span><span class="n">block_id</span><span class="p">,</span> <span class="n">lane_id</span><span class="p">,</span> <span class="n">side</span><span class="p">)]</span> <span class="o">+=</span> <span class="mi">1</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">side_chosen_to_retrieve</span><span class="p">[</span><span class="n">event</span><span class="o">.</span><span class="n">vehicle</span><span class="o">.</span><span class="n">id</span><span class="p">]</span> <span class="o">=</span> <span class="n">side</span>

                <span class="c1"># Si un robot voulait placer un véhicule dans la lane et le côté par lequel on veut sortir le véhicule cible du retrieval</span>
                <span class="k">for</span> <span class="n">robot</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">robots</span><span class="p">:</span>
                    <span class="k">if</span> <span class="ow">not</span> <span class="p">(</span><span class="n">robot</span><span class="o">.</span><span class="n">vehicle</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">)</span> <span class="ow">and</span> <span class="n">robot</span><span class="o">.</span><span class="n">doing</span> <span class="ow">and</span> <span class="n">robot</span><span class="o">.</span><span class="n">goal_position</span> <span class="o">==</span> <span class="p">(</span><span class="n">block_id</span><span class="p">,</span> <span class="n">lane_id</span><span class="p">,</span> <span class="n">side</span><span class="p">):</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">parking</span><span class="o">.</span><span class="n">blocks</span><span class="p">[</span><span class="n">block_id</span><span class="p">]</span><span class="o">.</span><span class="n">lanes</span><span class="p">[</span><span class="n">lane_id</span><span class="p">]</span><span class="o">.</span><span class="n">push_cancel_reserve</span><span class="p">(</span><span class="n">side</span><span class="p">)</span>
                        <span class="n">robot</span><span class="o">.</span><span class="n">goal_position</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">place</span><span class="p">(</span><span class="n">robot</span><span class="o">.</span><span class="n">vehicle</span><span class="p">,</span> <span class="n">robot</span><span class="o">.</span><span class="n">start_position</span><span class="p">,</span> <span class="n">current_time</span><span class="p">)</span>
                        <span class="c1"># Calcul du temps de trajet faux</span>
                        <span class="n">robot</span><span class="o">.</span><span class="n">goal_time</span>  <span class="o">=</span> <span class="n">current_time</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">parking</span><span class="o">.</span><span class="n">travel_time</span><span class="p">(</span><span class="n">robot</span><span class="o">.</span><span class="n">start_position</span><span class="p">,</span> <span class="n">robot</span><span class="o">.</span><span class="n">goal_position</span><span class="p">)</span>
                        <span class="n">event_end_task</span> <span class="o">=</span> <span class="n">Event</span><span class="p">(</span><span class="n">robot</span><span class="o">.</span><span class="n">vehicle</span><span class="p">,</span> <span class="n">robot</span><span class="o">.</span><span class="n">goal_time</span><span class="p">,</span> <span class="s2">&quot;robot_end_task&quot;</span><span class="p">,</span> <span class="n">robot</span><span class="p">)</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">events</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">event_end_task</span><span class="p">)</span>

                        <span class="n">robot</span><span class="o">.</span><span class="n">doing</span><span class="o">.</span><span class="n">canceled</span> <span class="o">=</span> <span class="kc">True</span>
                        <span class="n">robot</span><span class="o">.</span><span class="n">doing</span> <span class="o">=</span> <span class="n">event_end_task</span>

        <span class="c1"># Si un robot veut retirer de l&#39;interface un véhicule cible d&#39;un retrieval   </span>
        <span class="k">for</span> <span class="n">robot</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">robots</span><span class="p">:</span>
            <span class="k">if</span> <span class="p">(</span><span class="ow">not</span> <span class="n">robot</span><span class="o">.</span><span class="n">goal_position</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">)</span> <span class="ow">and</span> <span class="n">robot</span><span class="o">.</span><span class="n">doing</span><span class="p">:</span>
                <span class="n">block_id</span><span class="p">,</span> <span class="n">lane_id</span><span class="p">,</span> <span class="n">side</span> <span class="o">=</span> <span class="n">robot</span><span class="o">.</span><span class="n">goal_position</span>
                <span class="k">if</span> <span class="n">block_id</span> <span class="o">==</span> <span class="mi">0</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">parking</span><span class="o">.</span><span class="n">blocks</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">lanes</span><span class="p">[</span><span class="n">lane_id</span><span class="p">]</span><span class="o">.</span><span class="n">list_vehicles</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="n">event</span><span class="o">.</span><span class="n">vehicle</span><span class="o">.</span><span class="n">id</span><span class="p">:</span>
                    <span class="n">robot</span><span class="o">.</span><span class="n">target</span> <span class="o">=</span> <span class="kc">None</span>
                    <span class="n">robot</span><span class="o">.</span><span class="n">doing</span><span class="o">.</span><span class="n">canceled</span> <span class="o">=</span> <span class="kc">True</span>
                    <span class="n">robot</span><span class="o">.</span><span class="n">doing</span> <span class="o">=</span> <span class="kc">None</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">parking</span><span class="o">.</span><span class="n">blocks</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">targeted</span><span class="p">[</span><span class="n">lane_id</span><span class="p">]</span> <span class="o">=</span> <span class="kc">False</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">parking</span><span class="o">.</span><span class="n">blocks</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">lanes</span><span class="p">[</span><span class="n">lane_id</span><span class="p">]</span><span class="o">.</span><span class="n">pop_cancel_reserve</span><span class="p">(</span><span class="s2">&quot;bottom&quot;</span><span class="p">)</span>
                    <span class="n">robot</span><span class="o">.</span><span class="n">goal_position</span> <span class="o">=</span> <span class="n">robot</span><span class="o">.</span><span class="n">start_position</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">assign_task</span><span class="p">(</span><span class="n">robot</span><span class="p">)</span></div>
    
    <span class="k">def</span> <span class="nf">update_deposit</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">vehicle</span><span class="p">,</span> <span class="n">success</span><span class="p">,</span> <span class="n">current_time</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">current_time</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">update_retrieval</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">vehicle</span><span class="p">,</span> <span class="n">success</span><span class="p">,</span> <span class="n">current_time</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">success</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">current_time</span><span class="p">)</span>
    
    <span class="k">def</span> <span class="nf">update_robot_arrival</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">robot</span><span class="p">,</span> <span class="n">lane_end</span><span class="p">,</span> <span class="n">success</span><span class="p">,</span> <span class="n">moved_vehicle</span><span class="p">,</span> <span class="n">current_time</span><span class="p">):</span>

        <span class="k">if</span> <span class="n">success</span><span class="p">:</span>

            <span class="k">if</span> <span class="n">moved_vehicle</span><span class="o">.</span><span class="n">order_retrieval</span> <span class="o">&lt;=</span> <span class="n">current_time</span> <span class="ow">and</span> <span class="n">moved_vehicle</span><span class="o">.</span><span class="n">retrieval</span> <span class="o">-</span> <span class="n">current_time</span> <span class="o">&lt;</span> <span class="bp">self</span><span class="o">.</span><span class="n">anticipation_time</span><span class="p">:</span>
                <span class="n">i_lane</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">parking</span><span class="o">.</span><span class="n">blocks</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">empty_lane</span><span class="p">()</span>
                <span class="n">side_chosen_initially</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">side_chosen_to_retrieve</span><span class="p">[</span><span class="n">moved_vehicle</span><span class="o">.</span><span class="n">id</span><span class="p">]</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">locked_lanes</span><span class="p">[</span><span class="n">robot</span><span class="o">.</span><span class="n">goal_position</span><span class="p">[:</span><span class="mi">2</span><span class="p">]</span> <span class="o">+</span> <span class="p">(</span><span class="n">side_chosen_initially</span><span class="p">,)]</span> <span class="o">-=</span> <span class="mi">1</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">parking</span><span class="o">.</span><span class="n">blocks</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">lanes</span><span class="p">[</span><span class="n">i_lane</span><span class="p">]</span><span class="o">.</span><span class="n">push_reserve</span><span class="p">(</span><span class="n">moved_vehicle</span><span class="o">.</span><span class="n">id</span><span class="p">,</span> <span class="s2">&quot;bottom&quot;</span><span class="p">,</span> <span class="n">mark</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">parking</span><span class="o">.</span><span class="n">blocks</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">lanes</span><span class="p">[</span><span class="n">i_lane</span><span class="p">]</span><span class="o">.</span><span class="n">list_vehicles</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;Lock&quot;</span>
                <span class="c1">#On place le vehicule a l&#39;interface</span>
                <span class="n">robot</span><span class="o">.</span><span class="n">goal_position</span> <span class="o">=</span> <span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">i_lane</span><span class="p">,</span> <span class="s2">&quot;bottom&quot;</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">parking</span><span class="o">.</span><span class="n">blocks</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">nb_places_available</span> <span class="o">-=</span> <span class="mi">1</span>
                
                <span class="n">robot</span><span class="o">.</span><span class="n">goal_time</span> <span class="o">=</span> <span class="n">current_time</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">parking</span><span class="o">.</span><span class="n">travel_time</span><span class="p">(</span><span class="n">robot</span><span class="o">.</span><span class="n">start_position</span><span class="p">,</span> <span class="n">robot</span><span class="o">.</span><span class="n">goal_position</span><span class="p">)</span>
                <span class="n">event_end_task</span> <span class="o">=</span> <span class="n">Event</span><span class="p">(</span><span class="n">moved_vehicle</span><span class="p">,</span> <span class="n">robot</span><span class="o">.</span><span class="n">goal_time</span><span class="p">,</span> <span class="s2">&quot;robot_end_task&quot;</span><span class="p">,</span> <span class="n">robot</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">events</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">event_end_task</span><span class="p">)</span>
                <span class="n">robot</span><span class="o">.</span><span class="n">doing</span> <span class="o">=</span> <span class="n">event_end_task</span>

            <span class="k">else</span><span class="p">:</span>
                <span class="c1"># Effet de bord de l&#39;appel : bloque le side de la lane si avec l&#39;ajout du moved_vehicle il est rempli</span>
                <span class="n">robot</span><span class="o">.</span><span class="n">goal_position</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">place</span><span class="p">(</span><span class="n">moved_vehicle</span><span class="p">,</span> <span class="n">robot</span><span class="o">.</span><span class="n">goal_position</span><span class="p">,</span> <span class="n">current_time</span><span class="p">)</span>
                
                <span class="n">robot</span><span class="o">.</span><span class="n">goal_time</span> <span class="o">=</span> <span class="n">current_time</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">parking</span><span class="o">.</span><span class="n">travel_time</span><span class="p">(</span><span class="n">robot</span><span class="o">.</span><span class="n">start_position</span><span class="p">,</span> <span class="n">robot</span><span class="o">.</span><span class="n">goal_position</span><span class="p">)</span>
                <span class="n">event_end_task</span> <span class="o">=</span> <span class="n">Event</span><span class="p">(</span><span class="n">moved_vehicle</span><span class="p">,</span> <span class="n">robot</span><span class="o">.</span><span class="n">goal_time</span><span class="p">,</span> <span class="s2">&quot;robot_end_task&quot;</span><span class="p">,</span> <span class="n">robot</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">events</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">event_end_task</span><span class="p">)</span>
                <span class="n">robot</span><span class="o">.</span><span class="n">doing</span> <span class="o">=</span> <span class="n">event_end_task</span>
            

    <span class="k">def</span> <span class="nf">update_robot_end_task</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">robot</span><span class="p">,</span> <span class="n">lane_end</span><span class="p">,</span> <span class="n">success</span><span class="p">,</span> <span class="n">current_time</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">current_time</span><span class="p">)</span>
   
    <span class="k">def</span> <span class="nf">isRetrievalBetterThanDeposit</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">retrieval_event</span><span class="p">,</span> <span class="n">deposit_event</span><span class="p">):</span>
        <span class="c1"># calcul nombre véhicules dans l&#39;interface</span>
        <span class="n">nb_vehicules_interface</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="n">interface_size</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="k">for</span> <span class="n">place_lane</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">parking</span><span class="o">.</span><span class="n">blocks</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">lanes</span><span class="p">:</span>
            <span class="n">interface_size</span> <span class="o">+=</span> <span class="mi">1</span>
            <span class="k">if</span> <span class="n">place_lane</span><span class="o">.</span><span class="n">list_vehicles</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">:</span>
                <span class="n">nb_vehicules_interface</span> <span class="o">+=</span> <span class="mi">1</span>

        <span class="k">if</span> <span class="n">retrieval_event</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">return</span> <span class="kc">False</span>
        <span class="k">if</span> <span class="n">deposit_event</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">return</span> <span class="kc">True</span>
        
        <span class="k">return</span> <span class="n">nb_vehicules_interface</span><span class="o">/</span><span class="n">interface_size</span> <span class="o">&lt;</span> <span class="mf">0.75</span>
      
    <span class="k">def</span> <span class="nf">update</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">current_time</span><span class="p">):</span>
        <span class="k">for</span> <span class="n">robot</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">robots</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">robot</span><span class="o">.</span><span class="n">doing</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">assign_task</span><span class="p">(</span><span class="n">robot</span><span class="p">)</span></div>

<div class="viewcode-block" id="AlgorithmRandom"><a class="viewcode-back" href="../index.html#simulation.AlgorithmRandom">[docs]</a><span class="k">class</span> <span class="nc">AlgorithmRandom</span><span class="p">(</span><span class="n">BaseAlgorithm</span><span class="p">):</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">simulation</span><span class="p">,</span> <span class="n">t0</span><span class="p">,</span> <span class="n">stock</span><span class="p">,</span> <span class="n">robots</span><span class="p">,</span> <span class="n">parking</span><span class="p">,</span> <span class="n">events</span><span class="p">,</span> <span class="n">locked_lanes</span><span class="p">,</span> <span class="n">pending_retrievals</span><span class="p">,</span> <span class="n">anticipation_time</span><span class="o">=</span><span class="n">datetime</span><span class="o">.</span><span class="n">timedelta</span><span class="p">(</span><span class="n">hours</span><span class="o">=</span><span class="mi">8</span><span class="p">),</span> <span class="n">print_in_terminal</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="n">simulation</span><span class="p">,</span> <span class="n">t0</span><span class="p">,</span> <span class="n">stock</span><span class="p">,</span> <span class="n">robots</span><span class="p">,</span> <span class="n">parking</span><span class="p">,</span> <span class="n">events</span><span class="p">,</span> <span class="n">locked_lanes</span><span class="p">,</span> <span class="n">pending_retrievals</span><span class="p">,</span> <span class="n">anticipation_time</span><span class="p">,</span> <span class="n">print_in_terminal</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">place</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">vehicle</span><span class="p">,</span> <span class="n">start_position</span><span class="p">,</span> <span class="n">time</span><span class="p">,</span> <span class="n">max_iter</span><span class="o">=</span><span class="mi">1000</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">nb_placements</span> <span class="o">+=</span> <span class="mi">1</span>
        <span class="n">nb_iter</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="k">while</span> <span class="n">nb_iter</span> <span class="o">&lt;</span> <span class="n">max_iter</span><span class="p">:</span>
            <span class="n">rand_i_block</span> <span class="o">=</span> <span class="n">random</span><span class="o">.</span><span class="n">randrange</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">parking</span><span class="o">.</span><span class="n">blocks</span><span class="p">))</span>
            <span class="n">rand_i_lane</span> <span class="o">=</span> <span class="n">random</span><span class="o">.</span><span class="n">randrange</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">parking</span><span class="o">.</span><span class="n">blocks</span><span class="p">[</span><span class="n">rand_i_block</span><span class="p">]</span><span class="o">.</span><span class="n">lanes</span><span class="p">))</span>
            <span class="n">lane_chosen</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">parking</span><span class="o">.</span><span class="n">blocks</span><span class="p">[</span><span class="n">rand_i_block</span><span class="p">]</span><span class="o">.</span><span class="n">lanes</span><span class="p">[</span><span class="n">rand_i_lane</span><span class="p">]</span>
            <span class="k">if</span> <span class="n">random</span><span class="o">.</span><span class="n">randrange</span><span class="p">(</span><span class="mi">2</span><span class="p">):</span>
                <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">locked_lanes</span><span class="p">[(</span><span class="n">rand_i_block</span><span class="p">,</span> <span class="n">rand_i_lane</span><span class="p">,</span> <span class="s2">&quot;top&quot;</span><span class="p">)]:</span>
                    <span class="k">if</span> <span class="n">lane_chosen</span><span class="o">.</span><span class="n">is_top_available</span><span class="p">():</span>
                        <span class="n">lane_chosen</span><span class="o">.</span><span class="n">push_reserve</span><span class="p">(</span><span class="n">vehicle</span><span class="o">.</span><span class="n">id</span><span class="p">,</span> <span class="s2">&quot;top&quot;</span><span class="p">)</span>
                        <span class="k">return</span> <span class="p">(</span><span class="n">rand_i_block</span><span class="p">,</span> <span class="n">rand_i_lane</span><span class="p">,</span> <span class="s2">&quot;top&quot;</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">locked_lanes</span><span class="p">[(</span><span class="n">rand_i_block</span><span class="p">,</span> <span class="n">rand_i_lane</span><span class="p">,</span> <span class="s2">&quot;bottom&quot;</span><span class="p">)]:</span>
                    <span class="k">if</span> <span class="n">lane_chosen</span><span class="o">.</span><span class="n">is_bottom_available</span><span class="p">():</span>
                        <span class="n">lane_chosen</span><span class="o">.</span><span class="n">push_reserve</span><span class="p">(</span><span class="n">vehicle</span><span class="o">.</span><span class="n">id</span><span class="p">,</span> <span class="s2">&quot;bottom&quot;</span><span class="p">)</span>
                        <span class="k">return</span> <span class="p">(</span><span class="n">rand_i_block</span><span class="p">,</span> <span class="n">rand_i_lane</span><span class="p">,</span> <span class="s2">&quot;bottom&quot;</span><span class="p">)</span>
            <span class="n">nb_iter</span> <span class="o">+=</span> <span class="mi">1</span>
            <span class="k">if</span> <span class="n">nb_iter</span> <span class="o">==</span> <span class="n">max_iter</span><span class="p">:</span>
                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">print_in_terminal</span><span class="p">:</span>
                    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;ERREUR DE PLACEMENT&quot;</span><span class="p">)</span>
                    <span class="nb">print</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">parking</span><span class="p">)</span>
                    <span class="nb">print</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">locked_lanes</span><span class="p">)</span>
                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;le placement n&#39;a pas pu être effectué&quot;</span><span class="p">)</span>
    
    <span class="nd">@classmethod</span>
    <span class="k">def</span> <span class="fm">__repr__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="s2">&quot;Random&quot;</span></div>

<span class="c1">###########################################################################</span>
<span class="c1">#################### Changement de classe d&#39;algorithmes ###################</span>
<span class="c1">###########################################################################</span>

<div class="viewcode-block" id="WeightAlgorithm"><a class="viewcode-back" href="../index.html#simulation.WeightAlgorithm">[docs]</a><span class="k">class</span> <span class="nc">WeightAlgorithm</span><span class="p">(</span><span class="n">BaseAlgorithm</span><span class="p">):</span>
    
<div class="viewcode-block" id="WeightAlgorithm.place"><a class="viewcode-back" href="../index.html#simulation.WeightAlgorithm.place">[docs]</a>    <span class="k">def</span> <span class="nf">place</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">vehicle</span><span class="p">,</span> <span class="n">start_position</span><span class="p">,</span> <span class="n">date</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Algorithme de placement avec fonction de coût/pondération externalisée, cette fonction n&#39;a pas à changer quel que soit l&#39;algorithme de placement</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="c1"># paramètre utilisé dans performances (mesure)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">nb_placements</span> <span class="o">+=</span> <span class="mi">1</span>
        
        <span class="c1"># initialisation des extrémité de lane et poids associé pour la recherche du minimum</span>
        <span class="n">min_weight</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="n">min_lane_end</span> <span class="o">=</span> <span class="kc">None</span>

        <span class="c1"># self.locked_lanes = {extrémité de lane: bloquée ou non}</span>
        <span class="c1"># On parcourt l&#39;ensemble de ces extrémités et on cherche celle de poids minimal</span>

        <span class="k">for</span> <span class="n">lane_end</span><span class="p">,</span> <span class="n">is_locked</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">locked_lanes</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
            <span class="c1"># on s&#39;assure que la lane n&#39;est pas bloquée (qu&#39;il n&#39;y a pas de véhicule à sortir par cette extrémité) </span>
            <span class="c1"># et qu&#39;on ne replace pas le véhicule là où il est déjà</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">is_locked</span> <span class="ow">and</span> <span class="p">(</span><span class="n">start_position</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">or</span> <span class="n">start_position</span> <span class="o">!=</span> <span class="n">lane_end</span><span class="p">):</span>
                <span class="n">block_id</span><span class="p">,</span> <span class="n">lane_id</span><span class="p">,</span> <span class="n">side</span> <span class="o">=</span> <span class="n">lane_end</span>
                <span class="c1"># on vérifie que l&#39;extrémité choisie n&#39;est pas dans l&#39;interface : on ne peut pas effectuer de placement dans l&#39;interface (bloc 0)</span>
                <span class="k">if</span> <span class="n">block_id</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">:</span>
                    <span class="n">lane</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">parking</span><span class="o">.</span><span class="n">blocks</span><span class="p">[</span><span class="n">block_id</span><span class="p">]</span><span class="o">.</span><span class="n">lanes</span><span class="p">[</span><span class="n">lane_id</span><span class="p">]</span>
                    <span class="c1"># on vérifie que l&#39;extrémité de lane n&#39;est pas pleine</span>
                    <span class="k">if</span> <span class="n">lane</span><span class="o">.</span><span class="n">is_end_available</span><span class="p">(</span><span class="n">side</span><span class="p">):</span>
                        <span class="c1"># l&#39;extrémité n&#39;est pas pleine, pas bloquée, pas dans l&#39;interface et pas notre position de départ : </span>
                        <span class="c1"># on peut envisager de placer le véhicule ici</span>
                        <span class="c1"># calcul du poids dans une autre fonction</span>
                        <span class="n">weight</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">weight</span><span class="p">(</span><span class="n">vehicle</span><span class="p">,</span> <span class="n">start_position</span><span class="p">,</span> <span class="n">lane_end</span><span class="p">,</span> <span class="n">date</span><span class="p">)</span>

                        <span class="c1"># mise à jour du minimum si on a trouvé un meilleur candidat</span>
                        <span class="k">if</span> <span class="p">(</span><span class="ow">not</span> <span class="n">weight</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">)</span> <span class="ow">and</span> <span class="p">(</span><span class="n">min_weight</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">or</span> <span class="n">min_weight</span> <span class="o">&gt;</span> <span class="n">weight</span><span class="p">):</span>
                            <span class="n">min_weight</span> <span class="o">=</span> <span class="n">weight</span>
                            <span class="n">min_lane_end</span> <span class="o">=</span> <span class="n">lane_end</span>
        
        <span class="c1"># si on a trouvé une lane pour placer le véhicule</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="p">(</span><span class="n">min_weight</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">):</span>
            <span class="n">block_id</span><span class="p">,</span> <span class="n">lane_id</span><span class="p">,</span> <span class="n">side</span> <span class="o">=</span> <span class="n">min_lane_end</span>
            <span class="n">lane</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">parking</span><span class="o">.</span><span class="n">blocks</span><span class="p">[</span><span class="n">block_id</span><span class="p">]</span><span class="o">.</span><span class="n">lanes</span><span class="p">[</span><span class="n">lane_id</span><span class="p">]</span>
            <span class="c1"># on ajoute le véhicule à l&#39;extrémité de la lane choisi (le calcul du temps pris par le robot pour le faire est effectué ailleurs)</span>
            <span class="n">lane</span><span class="o">.</span><span class="n">push_reserve</span><span class="p">(</span><span class="n">vehicle</span><span class="o">.</span><span class="n">id</span><span class="p">,</span> <span class="n">side</span><span class="p">)</span>
            <span class="k">return</span> <span class="n">min_lane_end</span>
        <span class="c1"># sinon c&#39;est qu&#39;aucune extrémité de lane n&#39;est disponible (le poids minimum reste à None) : erreur</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;le placement n&#39;a pas pu être effectué&quot;</span><span class="p">)</span></div>
    
    <span class="k">def</span> <span class="nf">weight</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">vehicle</span><span class="p">,</span> <span class="n">start_position</span><span class="p">,</span> <span class="n">lane_end</span><span class="p">,</span> <span class="n">date</span><span class="p">):</span>
        <span class="k">return</span> <span class="mi">0</span></div>
 

<div class="viewcode-block" id="AlgorithmZeroMinus"><a class="viewcode-back" href="../index.html#simulation.AlgorithmZeroMinus">[docs]</a><span class="k">class</span> <span class="nc">AlgorithmZeroMinus</span><span class="p">(</span><span class="n">WeightAlgorithm</span><span class="p">):</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">simulation</span><span class="p">,</span> <span class="n">t0</span><span class="p">,</span> <span class="n">stock</span><span class="p">,</span> <span class="n">robots</span><span class="p">,</span> <span class="n">parking</span><span class="p">,</span> <span class="n">events</span><span class="p">,</span> <span class="n">locked_lanes</span><span class="p">,</span> <span class="n">pending_retrievals</span><span class="p">,</span> <span class="n">print_in_terminal</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">optimization_parameters</span><span class="o">=</span><span class="p">(</span><span class="mf">1.</span><span class="p">,</span> <span class="mf">3.</span><span class="p">,</span> <span class="mf">100.</span><span class="p">,</span> <span class="o">-</span><span class="mf">10.</span><span class="p">)):</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="n">simulation</span><span class="p">,</span> <span class="n">t0</span><span class="p">,</span> <span class="n">stock</span><span class="p">,</span> <span class="n">robots</span><span class="p">,</span> <span class="n">parking</span><span class="p">,</span> <span class="n">events</span><span class="p">,</span> <span class="n">locked_lanes</span><span class="p">,</span> <span class="n">pending_retrievals</span><span class="p">,</span> <span class="n">print_in_terminal</span><span class="o">=</span><span class="n">print_in_terminal</span><span class="p">)</span>
        
        <span class="c1">#paramètres de contrôle des poids</span>
        <span class="n">alpha</span><span class="p">,</span> <span class="n">beta</span><span class="p">,</span> <span class="n">start_new_lane_weight</span><span class="p">,</span> <span class="n">distance_to_lane_end_coef</span> <span class="o">=</span> <span class="n">optimization_parameters</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">alpha</span> <span class="o">=</span> <span class="n">alpha</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">beta</span> <span class="o">=</span> <span class="n">beta</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">start_new_lane_weight</span> <span class="o">=</span> <span class="n">start_new_lane_weight</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">distance_to_lane_end_coef</span> <span class="o">=</span> <span class="n">distance_to_lane_end_coef</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">optimization_parameters</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">optimization_parameters</span><span class="p">)</span>    <span class="c1"># /!\ changement de type</span>

    <span class="k">def</span> <span class="nf">weight</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">vehicle</span><span class="p">,</span> <span class="n">start_position</span><span class="p">,</span> <span class="n">lane_end</span><span class="p">,</span> <span class="n">date</span><span class="p">):</span>

        <span class="c1"># détermination de la place cible et simulation éventuelle des arrivées entre temps</span>

        <span class="n">block_id</span><span class="p">,</span> <span class="n">lane_id</span><span class="p">,</span> <span class="n">side</span> <span class="o">=</span> <span class="n">lane_end</span>
        <span class="n">lane</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">parking</span><span class="o">.</span><span class="n">blocks</span><span class="p">[</span><span class="n">block_id</span><span class="p">]</span><span class="o">.</span><span class="n">lanes</span><span class="p">[</span><span class="n">lane_id</span><span class="p">]</span>

        <span class="c1"># On simule l&#39;évolution de la lane : il ne faut pas prendre en compte les véhicules qui seront partis quand le notre arrivera (/!\ est-ce bien utile / pas risqué ?)</span>
        <span class="n">travel_time</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">parking</span><span class="o">.</span><span class="n">travel_time</span><span class="p">(</span><span class="n">start_position</span><span class="p">,</span> <span class="n">lane_end</span><span class="p">)</span>
        <span class="n">time_of_arrival</span> <span class="o">=</span> <span class="n">date</span> <span class="o">+</span> <span class="n">travel_time</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">future_lane</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">parking</span><span class="o">.</span><span class="n">future_config</span><span class="p">(</span><span class="n">lane</span><span class="p">,</span> <span class="n">block_id</span><span class="p">,</span> <span class="n">lane_id</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">robots</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">stock</span><span class="p">,</span> <span class="n">max_time</span> <span class="o">=</span> <span class="n">time_of_arrival</span><span class="p">)</span>
            <span class="n">future_lane</span><span class="o">.</span><span class="n">push</span><span class="p">(</span><span class="n">vehicle</span><span class="o">.</span><span class="n">id</span><span class="p">,</span> <span class="n">side</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">stock</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">parking</span><span class="o">.</span><span class="n">future_config</span><span class="p">(</span><span class="n">future_lane</span><span class="p">,</span> <span class="n">block_id</span><span class="p">,</span> <span class="n">lane_id</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">robots</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">stock</span><span class="p">,</span> <span class="n">min_time</span> <span class="o">=</span> <span class="n">time_of_arrival</span><span class="p">,</span> <span class="n">on_place</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
        <span class="k">except</span> <span class="ne">IndexError</span><span class="p">:</span>
            <span class="k">return</span> <span class="kc">None</span>


        <span class="c1">### détermination des variables régissant le poids ###</span>

        <span class="c1"># overweight : somme des pénalités pour les cas dégénérés</span>
        <span class="n">overweight</span> <span class="o">=</span> <span class="mi">0</span>

        <span class="c1"># détermination du nombre de places restantes dans la lane</span>
        <span class="k">if</span> <span class="n">side</span> <span class="o">==</span> <span class="s2">&quot;top&quot;</span><span class="p">:</span>
            <span class="n">distance_to_lane_end</span> <span class="o">=</span> <span class="n">future_lane</span><span class="o">.</span><span class="n">top_position</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">            if self.print_in_terminal:</span>
<span class="sd">                print(&quot;ERREUR DE PLACEMENT&quot;)</span>
<span class="sd">                print(self.parking)</span>
<span class="sd">                print(self.locked_lanes)</span>
<span class="sd">            raise ValueError(&quot;le placement n&#39;a pas pu être effectué&quot;)</span>
<span class="sd">            &quot;&quot;&quot;</span>
            <span class="n">distance_to_lane_end</span> <span class="o">=</span> <span class="n">future_lane</span><span class="o">.</span><span class="n">length</span> <span class="o">-</span> <span class="n">future_lane</span><span class="o">.</span><span class="n">bottom_position</span> <span class="o">-</span> <span class="mi">1</span>
        
        <span class="c1"># détermination de delta_t (en minutes)</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">delta_t</span> <span class="o">=</span> <span class="p">(</span><span class="n">vehicle</span><span class="o">.</span><span class="n">retrieval</span> <span class="o">-</span> <span class="n">future_lane</span><span class="o">.</span><span class="n">next_retrieval</span><span class="p">(</span><span class="n">side</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">stock</span><span class="p">,</span> <span class="n">exception</span><span class="o">=</span><span class="n">vehicle</span><span class="o">.</span><span class="n">retrieval</span><span class="p">))</span><span class="o">.</span><span class="n">total_seconds</span><span class="p">()</span><span class="o">/</span><span class="mi">60</span>
        <span class="k">except</span> <span class="ne">TypeError</span><span class="p">:</span>   <span class="c1"># cas où la lane ne contient pas d&#39;autre véhicule</span>
            <span class="n">delta_t</span> <span class="o">=</span> <span class="mi">0</span>
            <span class="n">overweight</span> <span class="o">+=</span> <span class="bp">self</span><span class="o">.</span><span class="n">start_new_lane_weight</span>

        <span class="c1"># détermination du temps de trajet en minutes</span>
        <span class="n">travel_time</span> <span class="o">=</span> <span class="n">travel_time</span><span class="o">.</span><span class="n">total_seconds</span><span class="p">()</span><span class="o">/</span><span class="mi">60</span>

        <span class="c1"># calcul du poids</span>
        <span class="n">weight</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">alpha</span><span class="o">*</span><span class="n">delta_t</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">beta</span><span class="o">*</span><span class="nb">abs</span><span class="p">(</span><span class="n">delta_t</span><span class="p">)</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">distance_to_lane_end_coef</span><span class="o">*</span><span class="n">distance_to_lane_end</span> <span class="o">+</span> <span class="n">overweight</span> <span class="o">+</span> <span class="n">travel_time</span>

        <span class="k">return</span> <span class="n">weight</span>

    <span class="nd">@classmethod</span>
    <span class="k">def</span> <span class="fm">__repr__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="s2">&quot;0-&quot;</span></div>



<div class="viewcode-block" id="AlgorithmNewUnimodal"><a class="viewcode-back" href="../index.html#simulation.AlgorithmNewUnimodal">[docs]</a><span class="k">class</span> <span class="nc">AlgorithmNewUnimodal</span><span class="p">(</span><span class="n">WeightAlgorithm</span><span class="p">):</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">simulation</span><span class="p">,</span> <span class="n">t0</span><span class="p">,</span> <span class="n">stock</span><span class="p">,</span> <span class="n">robots</span><span class="p">,</span> <span class="n">parking</span><span class="p">,</span> <span class="n">events</span><span class="p">,</span> <span class="n">locked_lanes</span><span class="p">,</span> <span class="n">pending_retrievals</span><span class="p">,</span> <span class="n">print_in_terminal</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="n">simulation</span><span class="p">,</span> <span class="n">t0</span><span class="p">,</span> <span class="n">stock</span><span class="p">,</span> <span class="n">robots</span><span class="p">,</span> <span class="n">parking</span><span class="p">,</span> <span class="n">events</span><span class="p">,</span> <span class="n">locked_lanes</span><span class="p">,</span> <span class="n">pending_retrievals</span><span class="p">,</span> <span class="n">print_in_terminal</span><span class="o">=</span><span class="n">print_in_terminal</span><span class="p">)</span>
        
        <span class="c1">#paramètres de contrôle des poids</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">break_unimodality_weight</span> <span class="o">=</span> <span class="mi">1000000</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">start_new_lane_weight</span> <span class="o">=</span> <span class="mi">10000</span>

    <span class="k">def</span> <span class="nf">weight</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">vehicle</span><span class="p">,</span> <span class="n">start_position</span><span class="p">,</span> <span class="n">lane_end</span><span class="p">,</span> <span class="n">date</span><span class="p">):</span>

        <span class="c1"># détermination de la place cible et simulation éventuelle des arrivées entre temps</span>

        <span class="n">block_id</span><span class="p">,</span> <span class="n">lane_id</span><span class="p">,</span> <span class="n">side</span> <span class="o">=</span> <span class="n">lane_end</span>
        <span class="n">lane</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">parking</span><span class="o">.</span><span class="n">blocks</span><span class="p">[</span><span class="n">block_id</span><span class="p">]</span><span class="o">.</span><span class="n">lanes</span><span class="p">[</span><span class="n">lane_id</span><span class="p">]</span>

        <span class="c1"># On simule l&#39;évolution de la lane : il ne faut pas prendre en compte les véhicules qui seront partis quand le notre arrivera (/!\ est-ce bien utile / pas risqué ?)</span>
        <span class="n">time_of_arrival</span> <span class="o">=</span> <span class="n">date</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">parking</span><span class="o">.</span><span class="n">travel_time</span><span class="p">(</span><span class="n">start_position</span><span class="p">,</span> <span class="n">lane_end</span><span class="p">)</span>
        <span class="n">before_time_of_arrival</span> <span class="o">=</span> <span class="n">time_of_arrival</span> <span class="o">-</span> <span class="n">datetime</span><span class="o">.</span><span class="n">timedelta</span><span class="p">(</span><span class="n">minutes</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">future_lane</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">parking</span><span class="o">.</span><span class="n">future_config</span><span class="p">(</span><span class="n">lane</span><span class="p">,</span> <span class="n">block_id</span><span class="p">,</span> <span class="n">lane_id</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">robots</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">stock</span><span class="p">,</span> <span class="n">max_time</span> <span class="o">=</span> <span class="n">before_time_of_arrival</span><span class="p">)</span>
            <span class="n">future_lane</span><span class="o">.</span><span class="n">push</span><span class="p">(</span><span class="n">vehicle</span><span class="o">.</span><span class="n">id</span><span class="p">,</span> <span class="n">side</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">stock</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">parking</span><span class="o">.</span><span class="n">future_config</span><span class="p">(</span><span class="n">future_lane</span><span class="p">,</span> <span class="n">block_id</span><span class="p">,</span> <span class="n">lane_id</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">robots</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">stock</span><span class="p">,</span> <span class="n">min_time</span> <span class="o">=</span> <span class="n">before_time_of_arrival</span><span class="p">,</span> <span class="n">on_place</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
        <span class="k">except</span> <span class="ne">IndexError</span><span class="p">:</span>
            <span class="k">return</span> <span class="kc">None</span>
        <span class="c1">### détermination des variables régissant le poids ###</span>

        <span class="c1"># overweight : somme des pénalités pour les cas dégénérés</span>
        <span class="n">overweight</span> <span class="o">=</span> <span class="mi">0</span>
        
        <span class="c1"># détermination de delta_t (en minutes)</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">delta_t</span> <span class="o">=</span> <span class="p">(</span><span class="n">vehicle</span><span class="o">.</span><span class="n">retrieval</span> <span class="o">-</span> <span class="n">future_lane</span><span class="o">.</span><span class="n">next_retrieval</span><span class="p">(</span><span class="n">side</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">stock</span><span class="p">,</span> <span class="n">exception</span><span class="o">=</span><span class="n">vehicle</span><span class="o">.</span><span class="n">retrieval</span><span class="p">))</span><span class="o">.</span><span class="n">total_seconds</span><span class="p">()</span><span class="o">/</span><span class="mi">60</span>
            <span class="c1"># on regarde si l&#39;on viole l&#39;unimodalité</span>
            <span class="k">if</span> <span class="n">delta_t</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
                <span class="n">overweight</span> <span class="o">+=</span> <span class="bp">self</span><span class="o">.</span><span class="n">break_unimodality_weight</span>

        <span class="k">except</span> <span class="ne">TypeError</span><span class="p">:</span>   <span class="c1"># cas où la lane ne contient pas d&#39;autre véhicule</span>
            <span class="n">delta_t</span> <span class="o">=</span> <span class="mi">0</span>
            <span class="n">overweight</span> <span class="o">+=</span> <span class="bp">self</span><span class="o">.</span><span class="n">start_new_lane_weight</span>

        <span class="c1"># calcul du poids</span>
        <span class="n">weight</span> <span class="o">=</span> <span class="n">delta_t</span> <span class="o">+</span> <span class="n">overweight</span>


        <span class="k">return</span> <span class="n">weight</span>

    <span class="nd">@classmethod</span>
    <span class="k">def</span> <span class="fm">__repr__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="s2">&quot;New Unimodal&quot;</span></div>

<div class="viewcode-block" id="AlgorithmUnimodalRefined0"><a class="viewcode-back" href="../index.html#simulation.AlgorithmUnimodalRefined0">[docs]</a><span class="k">class</span> <span class="nc">AlgorithmUnimodalRefined0</span><span class="p">(</span><span class="n">WeightAlgorithm</span><span class="p">):</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">simulation</span><span class="p">,</span> <span class="n">t0</span><span class="p">,</span> <span class="n">stock</span><span class="p">,</span> <span class="n">robots</span><span class="p">,</span> <span class="n">parking</span><span class="p">,</span> <span class="n">events</span><span class="p">,</span> <span class="n">locked_lanes</span><span class="p">,</span> <span class="n">pending_retrievals</span><span class="p">,</span> <span class="n">print_in_terminal</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="n">simulation</span><span class="p">,</span> <span class="n">t0</span><span class="p">,</span> <span class="n">stock</span><span class="p">,</span> <span class="n">robots</span><span class="p">,</span> <span class="n">parking</span><span class="p">,</span> <span class="n">events</span><span class="p">,</span> <span class="n">locked_lanes</span><span class="p">,</span> <span class="n">pending_retrievals</span><span class="p">,</span> <span class="n">print_in_terminal</span><span class="o">=</span><span class="n">print_in_terminal</span><span class="p">)</span>
        
        <span class="c1">#paramètres de contrôle des poids</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">break_unimodality_weight</span> <span class="o">=</span> <span class="mi">100000</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">start_new_lane_weight</span> <span class="o">=</span> <span class="mi">1000</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">distance_to_lane_end_coef</span> <span class="o">=</span> <span class="mf">100.</span>

    <span class="k">def</span> <span class="nf">weight</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">vehicle</span><span class="p">,</span> <span class="n">start_position</span><span class="p">,</span> <span class="n">lane_end</span><span class="p">,</span> <span class="n">date</span><span class="p">):</span>

        <span class="c1"># détermination de la place cible et simulation éventuelle des arrivées entre temps</span>

        <span class="n">block_id</span><span class="p">,</span> <span class="n">lane_id</span><span class="p">,</span> <span class="n">side</span> <span class="o">=</span> <span class="n">lane_end</span>
        <span class="n">lane</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">parking</span><span class="o">.</span><span class="n">blocks</span><span class="p">[</span><span class="n">block_id</span><span class="p">]</span><span class="o">.</span><span class="n">lanes</span><span class="p">[</span><span class="n">lane_id</span><span class="p">]</span>

        <span class="c1"># On simule l&#39;évolution de la lane : il ne faut pas prendre en compte les véhicules qui seront partis quand le notre arrivera (/!\ est-ce bien utile / pas risqué ?)</span>
        <span class="n">time_of_arrival</span> <span class="o">=</span> <span class="n">date</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">parking</span><span class="o">.</span><span class="n">travel_time</span><span class="p">(</span><span class="n">start_position</span><span class="p">,</span> <span class="n">lane_end</span><span class="p">)</span>
        <span class="n">before_time_of_arrival</span> <span class="o">=</span> <span class="n">time_of_arrival</span> <span class="o">-</span> <span class="n">datetime</span><span class="o">.</span><span class="n">timedelta</span><span class="p">(</span><span class="n">minutes</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">future_lane</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">parking</span><span class="o">.</span><span class="n">future_config</span><span class="p">(</span><span class="n">lane</span><span class="p">,</span> <span class="n">block_id</span><span class="p">,</span> <span class="n">lane_id</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">robots</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">stock</span><span class="p">,</span> <span class="n">max_time</span> <span class="o">=</span> <span class="n">before_time_of_arrival</span><span class="p">)</span>
            <span class="n">future_lane</span><span class="o">.</span><span class="n">push</span><span class="p">(</span><span class="n">vehicle</span><span class="o">.</span><span class="n">id</span><span class="p">,</span> <span class="n">side</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">stock</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">parking</span><span class="o">.</span><span class="n">future_config</span><span class="p">(</span><span class="n">future_lane</span><span class="p">,</span> <span class="n">block_id</span><span class="p">,</span> <span class="n">lane_id</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">robots</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">stock</span><span class="p">,</span> <span class="n">min_time</span> <span class="o">=</span> <span class="n">before_time_of_arrival</span><span class="p">,</span> <span class="n">on_place</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
        <span class="k">except</span> <span class="ne">IndexError</span><span class="p">:</span>
            <span class="k">return</span> <span class="kc">None</span>

        <span class="c1">### détermination des variables régissant le poids ###</span>

        <span class="c1"># overweight : somme des pénalités pour les cas dégénérés</span>
        <span class="n">overweight</span> <span class="o">=</span> <span class="mi">0</span>

        <span class="c1"># détermination du nombre de places restantes dans la lane</span>
        <span class="k">if</span> <span class="n">side</span> <span class="o">==</span> <span class="s2">&quot;top&quot;</span><span class="p">:</span>
            <span class="n">distance_to_lane_end</span> <span class="o">=</span> <span class="n">future_lane</span><span class="o">.</span><span class="n">top_position</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">distance_to_lane_end</span> <span class="o">=</span> <span class="n">future_lane</span><span class="o">.</span><span class="n">length</span> <span class="o">-</span> <span class="n">future_lane</span><span class="o">.</span><span class="n">bottom_position</span> <span class="o">-</span> <span class="mi">1</span>
        
        <span class="c1"># détermination de delta_t (en minutes)</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">delta_t</span> <span class="o">=</span> <span class="p">(</span><span class="n">vehicle</span><span class="o">.</span><span class="n">retrieval</span> <span class="o">-</span> <span class="n">future_lane</span><span class="o">.</span><span class="n">next_retrieval</span><span class="p">(</span><span class="n">side</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">stock</span><span class="p">,</span> <span class="n">exception</span><span class="o">=</span><span class="n">vehicle</span><span class="o">.</span><span class="n">retrieval</span><span class="p">))</span><span class="o">.</span><span class="n">total_seconds</span><span class="p">()</span><span class="o">/</span><span class="mi">60</span>     <span class="c1"># l&#39;espoir fait vivre</span>
            <span class="c1"># on regarde si l&#39;on viole l&#39;unimodalité</span>
            <span class="k">if</span> <span class="n">delta_t</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
                <span class="n">overweight</span> <span class="o">+=</span> <span class="bp">self</span><span class="o">.</span><span class="n">break_unimodality_weight</span>

        <span class="k">except</span> <span class="ne">TypeError</span><span class="p">:</span>   <span class="c1"># cas où la lane ne contient pas d&#39;autre véhicule</span>
            <span class="n">delta_t</span> <span class="o">=</span> <span class="mi">0</span>
            <span class="n">overweight</span> <span class="o">+=</span> <span class="bp">self</span><span class="o">.</span><span class="n">start_new_lane_weight</span>

        <span class="c1"># calcul du poids</span>
        <span class="n">weight</span> <span class="o">=</span> <span class="n">delta_t</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">distance_to_lane_end_coef</span><span class="o">*</span><span class="n">distance_to_lane_end</span> <span class="o">+</span> <span class="n">overweight</span>

        <span class="k">return</span> <span class="n">weight</span>

    <span class="nd">@classmethod</span>
    <span class="k">def</span> <span class="fm">__repr__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="s2">&quot;UR0&quot;</span></div>
</pre></div>

          </div>
          
        </div>
      </div>
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">
<h1 class="logo"><a href="../index.html">ParkMines</a></h1>








<h3>Navigation</h3>

<div class="relations">
<h3>Related Topics</h3>
<ul>
  <li><a href="../index.html">Documentation overview</a><ul>
  <li><a href="index.html">Code du module</a><ul>
  </ul></li>
  </ul></li>
</ul>
</div>
<div id="searchbox" style="display: none" role="search">
  <h3 id="searchlabel">Recherche rapide</h3>
    <div class="searchformwrapper">
    <form class="search" action="../search.html" method="get">
      <input type="text" name="q" aria-labelledby="searchlabel" />
      <input type="submit" value="Go" />
    </form>
    </div>
</div>
<script>$('#searchbox').show(0);</script>








        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="footer">
      &copy;2021, Marius ALONSO, Enol ALVAREZ, Laure BOURGUELLE, Pierre LOUISOT.
      
      |
      Powered by <a href="http://sphinx-doc.org/">Sphinx 4.0.2</a>
      &amp; <a href="https://github.com/bitprophet/alabaster">Alabaster 0.7.12</a>
      
    </div>

    

    
  </body>
</html>